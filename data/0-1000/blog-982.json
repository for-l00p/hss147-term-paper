{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":false,"creationTimeSeconds":1292770801,"rating":28,"authorHandle":"ralekseenkov","modificationTimeSeconds":1292798722,"id":982,"title":"Офигел и удивился. Баг в JVM","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003eНечасто мне в последнее время приходится писать код. Думал в это воскресенье быстренько напишу за часок нужную мне вещь, но не тут то было. Все написал, все отлично, но иногда программа падала на разных ассертах и непонятно из-за чего. А вроде все детерминированно - в яве проблем с неициализированной памятью нет, никаких коллекций с негарантированным порядком обхода я не использовал... в основном использовались только циклы и массивы. \u003cbr /\u003e\u003cbr /\u003eВ итоге убил пол дня на дебаг нестабильной программы, и оказалось баг в JVM! Если в функцию передаешь Integer.MAX_VALUE и пытаешься его использовать справа в сравнении на меньше или равно, в цикле, иногда возвращается false. \u003cbr /\u003e\u003cbr /\u003eВот минимальный код на котором происходит проблема.\u003cbr /\u003e\u003cpre\u003e\u003ca name\u003d\"line1\"\u003e 1\u003c/a\u003e \u003cstrong\u003epublic\u003c/strong\u003e \u003cstrong\u003eclass\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003eTest\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line2\"\u003e 2\u003c/a\u003e \u003cbr /\u003e\u003ca name\u003d\"line3\"\u003e 3\u003c/a\u003e     \u003cstrong\u003epublic\u003c/strong\u003e \u003cstrong\u003estatic\u003c/strong\u003e \u003cstrong\u003evoid\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003emain\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003eString\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e[\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e]\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003eargs\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line4\"\u003e 4\u003c/a\u003e         \u003cstrong\u003efor\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cstrong\u003eint\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003ei\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e0\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ei\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line5\"\u003e 5\u003c/a\u003e             \u003cstrong\u003etry\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line6\"\u003e 6\u003c/a\u003e                 \u003cfont color\u003d\"#2040a0\"\u003ego\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003eInteger\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003eMAX_VALUE\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line7\"\u003e 7\u003c/a\u003e             \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e \u003cstrong\u003ecatch\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003eException\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ee\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line8\"\u003e 8\u003c/a\u003e                 \u003cfont color\u003d\"#2040a0\"\u003eSystem\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003eerr\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003eprintln\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#008000\"\u003e\u0026quot;Failed after \u0026quot;\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ei\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e \u003cfont color\u003d\"#008000\"\u003e\u0026quot; iterations\u0026quot;\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line9\"\u003e 9\u003c/a\u003e                 \u003cstrong\u003ethrow\u003c/strong\u003e \u003cstrong\u003enew\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003eIllegalStateException\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003ee\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003egetMessage\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line10\"\u003e10\u003c/a\u003e             \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line11\"\u003e11\u003c/a\u003e         \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line12\"\u003e12\u003c/a\u003e     \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line13\"\u003e13\u003c/a\u003e \u003cbr /\u003e\u003ca name\u003d\"line14\"\u003e14\u003c/a\u003e     \u003cstrong\u003eprivate\u003c/strong\u003e \u003cstrong\u003estatic\u003c/strong\u003e \u003cstrong\u003evoid\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003ego\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cstrong\u003eint\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003emaxSteps\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line15\"\u003e15\u003c/a\u003e         \u003cstrong\u003eint\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e1\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line16\"\u003e16\u003c/a\u003e         \u003cstrong\u003ewhile\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u0026lt;\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003emaxSteps\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line17\"\u003e17\u003c/a\u003e             \u003cstrong\u003eif\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u0026gt;\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e10\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line18\"\u003e18\u003c/a\u003e                 \u003cstrong\u003ebreak\u003c/strong\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line19\"\u003e19\u003c/a\u003e             \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line20\"\u003e20\u003c/a\u003e             \u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line21\"\u003e21\u003c/a\u003e         \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line22\"\u003e22\u003c/a\u003e \u003cbr /\u003e\u003ca name\u003d\"line23\"\u003e23\u003c/a\u003e         \u003cstrong\u003eif\u003c/strong\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e!\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e10\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e{\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line24\"\u003e24\u003c/a\u003e             \u003cstrong\u003ethrow\u003c/strong\u003e \u003cstrong\u003enew\u003c/strong\u003e \u003cfont color\u003d\"#2040a0\"\u003eIllegalStateException\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#008000\"\u003e\u0026quot;Count \u003d \u0026quot;\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e+\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ecount\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e;\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line25\"\u003e25\u003c/a\u003e         \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line26\"\u003e26\u003c/a\u003e \u003cbr /\u003e\u003ca name\u003d\"line27\"\u003e27\u003c/a\u003e     \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003ca name\u003d\"line28\"\u003e28\u003c/a\u003e \u003cbr /\u003e\u003ca name\u003d\"line29\"\u003e29\u003c/a\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e}\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003c/pre\u003e\u003cbr /\u003eВыводит примерно следующее:\u003cbr /\u003e\u003cpre\u003e\u003cfont color\u003d\"#2040a0\"\u003e  Failed\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003eafter\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e2402\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003eiterations\u003c/font\u003e\u003cbr /\u003e\u003cfont color\u003d\"#2040a0\"\u003e  Exception\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ein\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ethread\u003c/font\u003e \u003cfont color\u003d\"#008000\"\u003e\u0026quot;main\u0026quot;\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003ejava\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003elang\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003eIllegalStateException\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e:\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003eCount\u003c/font\u003e \u003cfont color\u003d\"#4444ff\"\u003e\u003d\u003c/font\u003e \u003cfont color\u003d\"#ff0000\"\u003e2\u003c/font\u003e\u003cbr /\u003e  \t  \u003cfont color\u003d\"#2040a0\"\u003eat\u003c/font\u003e \u003cfont color\u003d\"#2040a0\"\u003eTest\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003emain\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e(\u003c/strong\u003e\u003c/font\u003e\u003cfont color\u003d\"#2040a0\"\u003eTest\u003c/font\u003e.\u003cfont color\u003d\"#2040a0\"\u003ejava\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e:\u003c/font\u003e\u003cfont color\u003d\"#ff0000\"\u003e9\u003c/font\u003e\u003cfont color\u003d\"#4444ff\"\u003e\u003cstrong\u003e)\u003c/strong\u003e\u003c/font\u003e\u003cbr /\u003e\u003cbr /\u003e\u003c/pre\u003eJava:\u003cbr /\u003ejava version \u0026quot;1.6.0_22\u0026quot;\u003cbr /\u003eJava(TM) SE Runtime Environment (build 1.6.0_22-b04-307-10M3261)\u003cbr /\u003eJava HotSpot(TM) 64-Bit Server VM (build 17.1-b03-307, mixed mode)\u003cbr /\u003e\u003cbr /\u003eБыл бы благодарен, если бы кто-нибудь потестил под разными системами - винда, линукс и отписался о результатах указывая OS и Java version.\u003cbr /\u003e\u003cbr /\u003e\u003cb\u003eUPD:\u003c/b\u003e спасибо всем откликнувшимся. видимо проблема в 64-битной JVM, проявляется на всех платформах. баг репорт отправлен в оракл, проходит скрининг \u003ca href\u003d\"http://bugs.sun.com/bugdatabase/view_bug.do?bug_id\u003d7007863\"\u003ehttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id\u003d7007863\u003c/a\u003e.\u003c/div\u003e","tags":["bug","java","jvm"]}}