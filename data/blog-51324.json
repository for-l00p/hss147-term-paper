{"status":"OK","result":{"originalLocale":"en","allowViewHistory":true,"creationTimeSeconds":1490872367,"rating":18,"authorHandle":"hpfdf","modificationTimeSeconds":1490872367,"id":51324,"title":"\u003cp\u003eSome strange behavior on C++ vector.\u003c/p\u003e","locale":"en","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cpre\u003e\u003ccode\u003e#include \u0026lt;iostream\u0026gt;\n#include \u0026lt;vector\u0026gt;\nusing namespace std;\n\nvector\u0026lt;int\u0026gt; a;\n\nint gen(int x) {\n  if (!x)\n    return 0;\n  int u \u003d a.size();\n  a.push_back(0);        //*/\n  a[u] \u003d gen(x - 1) + 1; /*/\n  int t \u003d gen(x - 1) + 1;\n  a[u] \u003d t;              //*/\n  return a[u];\n}\n\nint main() {\n  gen(10);\n  for (int x : a)\n    cout \u0026lt;\u0026lt; x \u0026lt;\u0026lt; \u0026quot; \u0026quot;;\n  cout \u0026lt;\u0026lt; endl;\n  return 0;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eI recently had a non-trivial bug related to std vector. Above is the simplified code to reproduce it. Semantically this should output 10 9 8 7 6 5 4 3 2 1 but actually it doesn\u0027t. The problem was here \u003ccode\u003ea[u] \u003d gen(x - 1) + 1\u003c/code\u003e. The vector a is reallocated before \u003ccode\u003egen(x - 1)\u003c/code\u003e finish, so the target \u003ccode\u003ea[u]\u003c/code\u003e is outdated. Adding a temp variable \u003ccode\u003et\u003c/code\u003e resolves this bug.\u003c/p\u003e\u003cp\u003eSummary: be careful playing with vectors. Never do \u003ccode\u003ea[i] \u003d f()\u003c/code\u003e, where \u003ccode\u003ef()\u003c/code\u003e could modify vector \u003ccode\u003ea\u003c/code\u003e.\u003c/p\u003e\u003c/div\u003e","tags":["c++","vector","bug","stl"]}}