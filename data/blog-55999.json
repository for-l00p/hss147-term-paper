{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":true,"creationTimeSeconds":1511608157,"rating":0,"authorHandle":"Coder_404","modificationTimeSeconds":1511608157,"id":55999,"title":"\u003cp\u003eLCA B-O(N log n) Q-O(log N) Binary lifting\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cpre\u003e\u003ccode\u003e#define N 111111\nint tin[N];\nint tout[N];\nVI g[N];\nint h[N];\nint up[N][20];\nint timer;\nvoid DFS(int v, int p) {\n\ttin[v] \u003d ++timer;\n\tup[v][0] \u003d p;\n\th[v] \u003d h[p] + 1;\n\n\tfor (int i\u003d1;i\u0026lt;20;i++) up[v][i] \u003d up[up[v][i - 1]][i - 1];\n\n\tfor (auto x : g[v])  \n\t\tif (x !\u003d p) DFS(x, v);\n\n\ttout[v] \u003d ++timer;\n}\nbool upper(int a, int b) {\n\treturn (tin[a] \u0026lt;\u003d tin[b] \u0026amp;\u0026amp; tout[b] \u0026lt;\u003d tout[a]);\n}\nint LCA(int a, int b) {\n//\tdb(a);\n//\tdb(b);\n\tif (upper(a, b)) return a;\n\tif (upper(b, a)) return b;\n\n\tfor (int i \u003d 19; i \u0026gt;\u003d 0;i--)\n\t\tif (!upper(up[a][i], b)) a \u003d up[a][i];\n\n\treturn up[a][0];\n}\nint dist(int a, int b) {\n\treturn (h[a] + h[b] - 2 * h[LCA(a, b)]);\n}\n\nvoid solve()\n{\n\tint n;\n\tcin \u0026gt;\u0026gt; n;\n\tint a, b;\n\tREP(i, 1, n) {\n\t\tcin \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b;\n\t\tg[a].push_back(b);\n\t\tg[b].push_back(a);\n\t}\n\tDFS(1, 1);\n\twhile (cin \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b) {\n\t\t//cout \u0026lt;\u0026lt; LCA(a, b) \u0026lt;\u0026lt; endl;\n\t\tcout \u0026lt;\u0026lt; dist(a, b) \u0026lt;\u0026lt; endl;\n\t}\n\n}\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","tags":[]}}