{"status":"OK","result":{"originalLocale":"en","allowViewHistory":true,"creationTimeSeconds":1516803891,"rating":770,"authorHandle":"jiry_2","modificationTimeSeconds":1517103816,"id":57319,"title":"\u003cp\u003eA simple introduction to \u0026quot;Segment tree beats\u0026quot;\u003c/p\u003e","locale":"en","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003eHi, I’d like to introduce a simple trick about segment tree in this blog as I promised in \u003ca href\u003d\"//codeforces.com/blog/entry/54750?#comment-387957\"\u003ethis comment\u003c/a\u003e. Sorry for the long delay, as a sophomore in Peking University, I\u0027ve just finished a tired semester and a painful final exam. And now I finally have enough time to do a simple introduction to this interesting algorithm.\u003c/p\u003e\u003cp\u003eIt may be a huge project for me since my English is not good. I think I will finish this blog in several steps and I will try to finish it as soon as possible :)\u003c/p\u003e\u003cp\u003eIn China, all of the 15 candidates for the Chinese National Team are asked to write a simple research report about algorithms in informatics Olympiad, and the score will be counted in the final selection. There are many interesting ideas and algorithms in these reports. And I find that some of them are quite new for competitors in CF although they are well known in China from the final standings of some recent contests. For example, In the last contest CF Round #458, the problem G can be easily solved using \u0026quot;power series beats\u0026quot; (Thanks for \u003ca class\u003d\"rated-user user-legendary\" href\u003d\"/profile/matthew99\" title\u003d\"Legendary grandmaster matthew99\"\u003e\u003cspan class\u003d\"legendary-user-first-letter\"\u003em\u003c/span\u003eatthew99\u003c/a\u003e to give this name :)) in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(2\u003csup class\u003d\"upper-index\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/sup\u003e\u003ci\u003en\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e which was imported in China by \u003ca class\u003d\"rated-user user-red\" href\u003d\"/profile/Vfleaking\" title\u003d\"Grandmaster Vfleaking\"\u003eVfleaking\u003c/a\u003e in 2015.\u003c/p\u003e\u003cp\u003eThis blog is about my report which is written about two years ago. I am satisfied with this work although there is a flaw about time complexity. \u003ca class\u003d\"rated-user user-legendary\" href\u003d\"/profile/xyz111\" title\u003d\"Legendary grandmaster xyz111\"\u003e\u003cspan class\u003d\"legendary-user-first-letter\"\u003ex\u003c/span\u003eyz111\u003c/a\u003e gave me a lot of inspiration, and the name “Segment tree beats” is given by \u003ca class\u003d\"rated-user user-red\" href\u003d\"/profile/C_SUNSHINE\" title\u003d\"Grandmaster C_SUNSHINE\"\u003eC_SUNSHINE\u003c/a\u003e which is from a famous Japanese anime “Angel Beats”.\u003c/p\u003e\u003cp\u003eHere is \u003ca href\u003d\"http://www.doc88.com/p-6744902151779.html\"\u003ethe link\u003c/a\u003e about the Chinese version of this report.\u003c/p\u003e\u003ch3\u003ePart1. What it can do.\u003c/h3\u003e\u003cp\u003eThis work has two parts:\u003c/p\u003e \u003col\u003e   \u003cli\u003eTransform interval max/min (for \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/d9/ff/d9ff1721d8dcaf1ddc4141d5fc6a30b9c4dda491.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e) operations into interval add/subtract operations in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(1)\u003c/span\u003e or \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/li\u003e   \u003cli\u003eTransform history max/min/sum queries into interval max/min operations in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(1)\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eHere are some sample problems I used in my report. At first you have a array \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e of length \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/span\u003e and two auxiliary arrays \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e, \u003ci\u003eC\u003c/i\u003e\u003c/span\u003e. Initially, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003c/span\u003e is equal to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003c/span\u003e is all zero.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 1\u003c/strong\u003e. There are two kinds of operations:\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eIt can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 2\u003c/strong\u003e. We can add more operations to Task 1: \u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e can be a negative number\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eIt can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and I could not proved the exact time complexity yet, maybe It is still \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e ;)\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 3\u003c/strong\u003e. And we can query for some other things:\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e can be a negative number\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eAfter each operation, for each \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, if \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e changed in this operation, add \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eIt’s time complexity is the same as Task 2.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 4\u003c/strong\u003e. We can also deal with several arrays synchronously. Assume there are two arrays \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e1\u003c/sub\u003e\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e\u003c/span\u003e of length \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e can be a negative number\u003c/li\u003e   \u003cli\u003eQuery for the max \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e1, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2, \u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eIt can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and if there are \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ek\u003c/i\u003e\u003c/span\u003e arrays, the time complexity will be raised to \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/d6/7cd60635a6cbd1f59753a6e25a1773093c53c195.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 5\u003c/strong\u003e. And there are some tasks about historic information.\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e can be a negative number.\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eAfter each operation, for each \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e and add \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eThe query for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and the query for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 6\u003c/strong\u003e. We can even merged the two parts together. \u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e can be a negative number.\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eAfter each operation, for each \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eIt can be solved in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/fc/c9/fcc99b14c71adb763f5fe7dc6fd33a59f1a9001f.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eThere are \u003cspan class\u003d\"tex-span\"\u003e11\u003c/span\u003e sample tasks in my report and here are \u003cspan class\u003d\"tex-span\"\u003e6\u003c/span\u003e of them. All of them are interesting and are hard to solve using the traditional techniques such as lazy tags. \u003c/p\u003e\u003ch3\u003ePart2. The main idea\u003c/h3\u003e\u003ch4\u003eInterval min/max operations\u003c/h4\u003e\u003cp\u003eTo make the description clearer, I think it’s better to introduce an extended segment tree template. \u003c/p\u003e\u003cp\u003eI think most of the competitors’ templates of the lazy tag is like this (\u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e is the node\u0027s interval and \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003ell\u003c/i\u003e, \u003ci\u003err\u003c/i\u003e]\u003c/span\u003e is the operation\u0027s interval):\u003c/p\u003e \u003cpre\u003e\u003ccode\u003evoid modify(int node, int l, int r, int ll, int rr) {\n  if (l \u0026gt; rr || r \u0026lt; ll) return;\n  if (l \u0026gt;\u003d ll \u0026amp;\u0026amp; r \u0026lt;\u003d rr) {\n      puttag(node); return;\n  }\n  pushdown(node);\n  int mid \u003d (l + r) \u0026gt;\u0026gt; 1;\n  modify(node * 2, l, mid, ll, rr);\n  modify(node * 2 + 1, mid + 1, r, ll ,rr);\n  update();\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe main idea is \u003cstrong\u003ereturn whenever we can, put the tag whenever we can\u003c/strong\u003e:\u003c/p\u003e \u003col\u003e   \u003cli\u003eWhen the operation\u0027s interval and the node\u0027s interval are no longer intersected, the information inside this subtree must not be affected. So we can return immediately.\u003c/li\u003e   \u003cli\u003eWhen the node\u0027s interval is contained by the operation\u0027s interval, all the information inside the subtree will be changed together. So we can put the tag on it and return.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eIn other words, we can replace the two conditions arbitrarily, i.e., we can extend the template like this:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003evoid modify(int node, int l, int r, int ll, int rr) {\n  if (break_condition()) return;\n  if (tag_condition()) {\n      puttag(node); return;\n  }\n  pushdown(node);\n  int mid \u003d (l + r) \u0026gt;\u0026gt; 1;\n  modify(node * 2, l, mid, ll, rr);\n  modify(node * 2 + 1, mid + 1, r, ll ,rr);\n  update();\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWhat\u0027s the use of such a modification? In some advanced data structure tasks, it\u0027s impossible for us to put tags in such a weak condition \u003ccode\u003el \u0026gt;\u003d ll \u0026amp;\u0026amp; r \u0026lt;\u003d rr\u003c/code\u003e. But we can put it when the condition is stronger. We can use this template to deal with this kind of tasks but we need to analyze the time complexity carefully. \u003c/p\u003e\u003cp\u003e\u003cstrong\u003eSimple task:\u003c/strong\u003e There are three kinds of operations:\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/8f/d1/8fd1194aadc539686cfe0cd659572671573d83f3.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eQuery for the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eIt\u0027s a classic problem (it\u0027s the simple extension of \u003ca href\u003d\"/contest/438/problem/D\" title\u003d\"Codeforces Round 250 (Div. 1)\"\u003e438D - The Child and Sequence\u003c/a\u003e) and the traditional solution is to use balanced tree such as splay/treap to maintain the continuous segments with the same \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e and for operation \u003cspan class\u003d\"tex-span\"\u003e2\u003c/span\u003e, we find out all the segments with \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e ≥ \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e and change the value of each one.\u003c/p\u003e\u003cp\u003eBut if we use segment tree, we can get a much simpler solution: let \u003ccode\u003ebreak_condition\u003c/code\u003e be \u003ccode\u003el \u0026gt; rr || r \u0026lt; ll || max_value[node] \u0026lt; x\u003c/code\u003e and let \u003ccode\u003etag_condition\u003c/code\u003e be \u003ccode\u003el \u0026gt;\u003d ll \u0026amp;\u0026amp; r \u0026lt;\u003d rr \u0026amp;\u0026amp; max_value[node] \u003d\u003d min_value[node]\u003c/code\u003e. And we can find that the time complexity of this segment tree is also \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eAnd now, we can easily describe the main idea of \u0026quot;segment tree beats\u0026quot;. For each node, we maintain the maximum value \u003ccode\u003emax_value[node]\u003c/code\u003e and the strict second maximum value \u003ccode\u003esecond_value[node]\u003c/code\u003e. \u003c/p\u003e\u003cp\u003eWhen we are doing the interval min operation for number \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e. let \u003ccode\u003ebreak_condition\u003c/code\u003e be \u003ccode\u003el \u0026gt; rr || r \u0026lt; ll || max_value[node] \u0026lt;\u003d x\u003c/code\u003e and let \u003ccode\u003etag_condition\u003c/code\u003e be \u003ccode\u003el \u0026gt;\u003d ll \u0026amp;\u0026amp; r \u0026lt;\u003d rr \u0026amp;\u0026amp; second_value[node] \u0026lt; x\u003c/code\u003e. Under such an condition, after put this tag, all of the maximum values inside this subtree will be changed to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e and they are still the maximum values of this subtree. \u003c/p\u003e\u003cp\u003eTo make it easier to merge with other operations, we can maintain the values in this way: For each node, we maintain the maximum value inside this subtree and other values separately (the maximum values are the first kind and others are the second). Then, interval max operation will be changed to \u0026quot;add a number to the first kind values in some intervals\u0026quot;. Keep the meanings of each kinds of values and the tags, you will find that the processes of pushdown and update will be much clearer.\u003c/p\u003e\u003cp\u003eThat\u0027s the main idea of the first part of \u0026quot;segment tree beats\u0026quot;. It is very simple, right? And it also has a very nice time complexity. (I will give out the proof of the time complexity in the third part of this article).\u003c/p\u003e\u003cp\u003eAnd let\u0027s see the first two sample tasks in part 1.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 1\u003c/strong\u003e. In this task, we can maintain the number of the first kind of values inside each node \u003ccode\u003et[node]\u003c/code\u003e, and when we put tag \u0026quot;add \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e to the first kind values in this subtree\u0026quot;, the sum will be added by \u003ccode\u003et[node] * x\u003c/code\u003e. Then we can easily maintain the information we need. \u003c/p\u003e\u003cp\u003e\u003cstrong\u003eTask 2\u003c/strong\u003e. In this task, we can maintain the maximum values/ minimum values and others separately, i.e., there are three kinds of numbers now, and we will use three sets of tags for each kind of values. Also, to deal with the queries of the interval\u0027s sum, we need to maintain the numbers of the first kind and the second kind of values. Pay attention to some boundary conditions, if there are just two different values in this subtree, there will be no third kind of values and if all the values are the same, the set of the first kind and the second kind will be the same\u003c/p\u003e\u003ch4\u003eHistoric information\u003c/h4\u003e\u003cp\u003eIn this part, we will focus on three special values which I named \u0026quot;historic information\u0026quot;:\u003c/p\u003e \u003col\u003e   \u003cli\u003ehistoric maximal value: after each operation, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003ehistoric minimal value: after each operation, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e\u003c/li\u003e   \u003cli\u003ehistoric sum: after each operation, add \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e by \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eYou may wonder why we need to consider these values. But in China, there had been several problems about these values before I wrote this report. And maintaining these values is a much harder task than it looks like. Here is a data structure task in Tsinghua University Training 2015:\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eSample Task\u003c/strong\u003e: \u003ca href\u003d\"http://uoj.ac/problem/164\"\u003eHere\u003c/a\u003e is the link of this problem. There are five kinds of operations (\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e is a positive integer.):\u003c/p\u003e \u003col\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003ex\u003c/i\u003e, 0)\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eFor all \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e8/23/e8232d9209ef0c8f33de973274f1ee3f10902286.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eQuery for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eQuery for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eAfter each operation, change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eTo solve this task, ordinary segment tree is enough. But It\u0027s not easy to deal with the relationship between the lazy tags and the historic information. I think it\u0027s a good sample problem to show the features of historic information.\u003c/p\u003e \u003cdiv class\u003d\"spoiler\"\u003e\u003cb class\u003d\"spoiler-title\"\u003eHere is the solution\u003c/b\u003e\u003cdiv class\u003d\"spoiler-content\" style\u003d\"display: none;\"\u003e\u003cp\u003eIn this problem, the lazy tag is a function \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e) \u003d \u003ci\u003emax\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e + \u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e. The first operation is \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ex\u003c/i\u003e,  + ∞\u003c/sub\u003e\u003c/span\u003e, the second operation is \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ex\u003c/i\u003e, 0\u003c/sub\u003e\u003c/span\u003e, and the third operation is \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e - ∞, \u003ci\u003ex\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eAnd these tags can be merged: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e, \u003ci\u003ed\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e)) \u003d \u003ci\u003emax\u003c/i\u003e(\u003ci\u003emax\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e + \u003ci\u003ec\u003c/i\u003e, \u003ci\u003ed\u003c/i\u003e) + \u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e) \u003d \u003ci\u003emax\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e + \u003ci\u003ea\u003c/i\u003e + \u003ci\u003ec\u003c/i\u003e, \u003ci\u003emax\u003c/i\u003e(\u003ci\u003ea\u003c/i\u003e + \u003ci\u003ed\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)) \u003d \u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e + \u003ci\u003ec\u003c/i\u003e, \u003ci\u003emax\u003c/i\u003e(\u003ci\u003ea\u003c/i\u003e + \u003ci\u003ed\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/sub\u003e\u003c/span\u003e. Then we can easily maintain the current value of each node.\u003c/p\u003e\u003cp\u003eHow about the historic maximum value? What if we just maintain a historic maximum value \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e on each leaf and make \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003emax\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e))\u003c/span\u003e (\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e is the current value) after putting tag \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e? Unfortunately, it\u0027s wrong. We all know that the main idea of lazy tags is delaying the operation. When we push down a lazy tag, it may contain the information of many operations. So we could not maintain the historic value this way because we will lose the information of the versions which are delayed by lazy tags.\u003c/p\u003e\u003cp\u003eA good way is to maintain another tag on each node: historic maximum tag: It is a function \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e which means if the value before pushdown is \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, then after pushdown, the maximum value among these blocked version is \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eSometimes we can not maintain this function, but fortunately, in this problem, we can. \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e also has the form \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e)(\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e))\u003c/span\u003e and this tag can also be merged. After push down the tag \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e), \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e, \u003ci\u003ed\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e))\u003c/span\u003e to a node in which the old tag is \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ee\u003c/i\u003e, \u003ci\u003ef\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e), \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eg\u003c/i\u003e, \u003ci\u003eh\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e, the historic maximum tag will be changed to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eg\u003c/i\u003e, \u003ci\u003eh\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e), \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e, \u003ci\u003ed\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ee\u003c/i\u003e, \u003ci\u003ef\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e)))\u003c/span\u003e. The following picture shows that this function also has the form \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003e\u003cimg alt\u003d\" \" src\u003d\"/predownloaded/31/89/318908ef1d88bdfc3b1256193ae75e4a9bc978b0.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/p\u003e\u003cp\u003eThus, we can just use tags and ordinary segment tree to solve this problem in \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. \u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003eWe have already gotten the way to deal with the interval min/max operations. And they are good tools to maintain historic information. \u003c/p\u003e\u003cp\u003eNow, let use consider such a kind of problems (Part1. Task 5): interval add/subtract, query for the interval sum of historic information. It\u0027s quite hard since we can\u0027t just use the traditional lazy tag technique to solve it. But we can use an auxiliary array \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e with the initial value of all zero to do some transformation:\u003c/p\u003e \u003col\u003e   \u003cli\u003eHistoric maximal value: let \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Then if we change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e will be changed to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emax\u003c/i\u003e(\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003ex\u003c/i\u003e, 0)\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eHistoric minimal value: let \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Then if we change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e will be changed to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emin\u003c/i\u003e(\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003ex\u003c/i\u003e, 0)\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eHistoric sum: let \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - \u003ci\u003etA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e while \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003et\u003c/i\u003e\u003c/span\u003e is the current operation id. Then if we change \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e + \u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e will be changed to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e - (\u003ci\u003et\u003c/i\u003e - 1)\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eWe can use the technique introduced in the previous part about interval min/max operations to maintain the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eD\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. And then we could get the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eB\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e or \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eC\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eWhat\u0027s more, since we have already transformed interval min/max operations to interval add/subtract operations, we can also maintain the interval sum of historic information under interval min/max operations (Part1. Task 6). This is a simple expansion and I think it\u0027s better to leave it as an exercise.\u003c/p\u003e\u003ch3\u003ePart 3. The time complexity\u003c/h3\u003e\u003cp\u003eIn this part, I will give the proofs of the time complexity of Part 1 Task 1 and Part 1 Task 2. You can find that the proof of Task 2 is universal: it is equally applicable to Task 3 to Task 5. And Task 6 can be regarded as two layer nested “segment tree beats”. It\u0027s time complexity can be proved using the same way as Task 2. \u003c/p\u003e\u003ch4\u003eTask 1\u003c/h4\u003e\u003cp\u003eIn this part, we will proof the algorithm showed in Part 2 of this problem is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e: interval \u003cstrong\u003emin\u003c/strong\u003e operation, query for the interval sum.\u003c/p\u003e\u003cp\u003e\u003ca class\u003d\"rated-user user-orange\" href\u003d\"/profile/gepardo\" title\u003d\"International master gepardo\"\u003egepardo\u003c/a\u003e has given a clear proof to show the time complexity of this problem is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e in this \u003ca href\u003d\"//codeforces.com/blog/entry/57319?#comment-409924\"\u003ecomment\u003c/a\u003e. Here, I\u0027d like to show another proof which is much more complex. But I think it is my closest attempt to proof Task 2 is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. And this proof will show the relationship between \u0026quot;segment tree beats\u0026quot; and the solution of this problem given by \u003ca class\u003d\"rated-user user-legendary\" href\u003d\"/profile/xyz111\" title\u003d\"Legendary grandmaster xyz111\"\u003e\u003cspan class\u003d\"legendary-user-first-letter\"\u003ex\u003c/span\u003eyz111\u003c/a\u003e (you can find this solution in this \u003ca href\u003d\"http://blog.sina.com.cn/s/blog_15139f1a10102vnzl.html\"\u003ewebsite\u003c/a\u003e. The name of this problem is \u0026quot;Gorgeous Sequence\u0026quot; and the solution is written in English).\u003c/p\u003e\u003cp\u003eThe main idea is to transform max value into tags. Let the tag of each node in segment tree be the maximum value inside its interval. And if a node has the same tag as its father, we will remove the tag on it. Here is an simple example:\u003c/p\u003e\u003cp\u003e\u003cimg alt\u003d\" \" src\u003d\"/predownloaded/0c/ba/0cba1dc5c83ec0fec1b47392f6185f81752cbc0a.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/p\u003e\u003cp\u003eThe left picture shows the maximum value of each node in a segment tree of array \u003cspan class\u003d\"tex-span\"\u003e[1, 2, 4, 3]\u003c/span\u003e. And the left picture is the tags. \u003c/p\u003e\u003cp\u003eAfter the transformation, we can find that the strict second maximum value we maintained is just the maximum tag inside each subtree. \u003c/p\u003e\u003cp\u003eOne important property of these tags is each tag is strictly greater than the tags inside its subtree. But why this property still holds after interval min operations? Consider the difference between this algorithm with the original segment tree: We will visit more nodes when \u003ccode\u003esecond_value[node] \u0026gt;\u003d x\u003c/code\u003e. This process ensure that we will put a tag only if all the tags inside this subtree is smaller than the new tag, i.e., we visit these large tags and delete them.\u003c/p\u003e\u003cp\u003eWhen do the tags change? One possibility is after an interval min operation, we will delete some tags and add some new tags. And another possibility is that if we just change some of the values inside the node, the previous tag may be pushed down after \u003ccode\u003epushdown()\u003c/code\u003e (The maximum value of this subtree may be changed.)\u003c/p\u003e\u003cp\u003eFor the convenience of description, let us define tag classes:\u003c/p\u003e \u003col\u003e   \u003cli\u003eAll the tags added in the same interval min operation belong to the same tag class.\u003c/li\u003e   \u003cli\u003eAfter a pushdown, the new tag belongs to the same tag class as the old tag.\u003c/li\u003e   \u003cli\u003eAny two tags which do not satisfy above two conditions belong to different tag classes.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eAnd we can divide the nodes we visit in a single interval min operation into two sets: ordinary nodes and extra nodes. Ordinary nodes are those nodes which an ordinary segment tree also visit in an operation of \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e, and extra nodes are those nodes which we visit because the stronger \u003ccode\u003ebreak_condition\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eThen, let \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ew\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e)\u003c/span\u003e (\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e is a tag class) be the number of nodes which has at least one tag in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e inside its subtree, and let the potential function \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e be the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ew\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e)\u003c/span\u003e for all existing \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eSince there are at most \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/span\u003e tags in the segment tree, so the initial value of \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. Consider the influences to \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e:\u003c/p\u003e \u003col\u003e   \u003cli\u003eAfter a \u003ccode\u003epushdown()\u003c/code\u003e, the old tag will be pushed down to two children of \u003ccode\u003enode\u003c/code\u003e, so \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e will be increased by \u003cspan class\u003d\"tex-span\"\u003e2\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eThe new tag will occur on only ordinary nodes. So for the new tag class \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ew\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. Since the number of ordinary nodes is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/li\u003e   \u003cli\u003eThe reason we visit an extra node is that we need to delete some tags inside its subtree. And a clear fact is that if we delete a tag in tag set \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e inside a subtree, all the tags in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e inside this subtree will be also deleted. So, after visiting each extra node, \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e will be subtract by at least \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eSince the total increase of \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and each extra node will subtract \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e from \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e, we know that the time complexity is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eYou may find that this potential function is just the same as the proof given by [usr:gepardo]. But using tags can bring us much more useful properties, and we can come up with some useful potential functions from the tags of which the definitions can be very strange if we want to define them just from the values. You may see it from the proof of the task 2.\u003c/p\u003e\u003ch4\u003eTask 2\u003c/h4\u003e\u003cp\u003eIn this task, we will still use the tags defined in previous proof, and the potential function we choose is a little strange: let \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e(\u003ci\u003et\u003c/i\u003e)\u003c/span\u003e ( \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003et\u003c/i\u003e\u003c/span\u003e is a tag ) be the depth of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003et\u003c/i\u003e\u003c/span\u003e in the segment tree and \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e be the sum of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e(\u003ci\u003et\u003c/i\u003e)\u003c/span\u003e for all existing tags. And since \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e(\u003ci\u003et\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and the number of the tags is no more than \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/span\u003e. So the initial value of \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e7/0f/e70fbdc8079c0b9ff4f31073012937bac199bc6b.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eThen, let\u0027s consider the influences to \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e:\u003c/p\u003e \u003col\u003e   \u003cli\u003eAfter an interval min operation, there will be no tags on the extra nodes. So we can just consider \u003ccode\u003epushdown\u003c/code\u003e on ordinary nodes (For the interval add/subtract operations, we visit only ordinary nodes, so the following discussion is still correct) . And after a \u003ccode\u003epushdown\u003c/code\u003e, the old tag will be pushed down to the two children of \u003ccode\u003enode\u003c/code\u003e, and \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e will be added by \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. Since there are \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/7c/4d/7c4d711d6db4afdaebd7dc33a74586d66f567bfc.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e ordinary nodes, \u003ccode\u003epushdown\u003c/code\u003e will make \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e increased by \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/74/10/7410a69421c6ee91a5842650f56f6dd28c3fad9a.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e each interval min operation.\u003c/li\u003e   \u003cli\u003eThe new tag will occur on only ordinary nodes, so it will also make \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e increased by \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/74/10/7410a69421c6ee91a5842650f56f6dd28c3fad9a.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/li\u003e   \u003cli\u003eEach extra node will make \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e decreased by \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e because there must be a tag deeper than this node which is deleted after this operation.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eSince the total increase of \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and each extra node will subtract \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e from \u003cspan class\u003d\"tex-span\"\u003eΦ(\u003ci\u003ex\u003c/i\u003e)\u003c/span\u003e, we prove that the time complexity is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ca/4c/ca4c38da7d143fc87534d50aa6d551dd861caae9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eWhat\u0027s more, in this proof, we do not use any special properties of interval add/subtract operation. So the proof is still hold for other operations. That\u0027s why I call this proof universal.\u003c/p\u003e\u003cp\u003eSo far, this article is finished. I\u0027ve never thought that it will be so popular. Thanks a lot for the encouragement and the support. I hope this article can help :)\u003c/p\u003e\u003c/div\u003e","tags":["#data structure"]}}