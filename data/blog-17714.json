{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":false,"creationTimeSeconds":1430757172,"rating":65,"authorHandle":"Kvark161","modificationTimeSeconds":1430771730,"id":17714,"title":"\u003cp\u003eСпособ выстрелить себе в ногу?\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003e\u003ca class\u003d\"rated-user user-blue\" href\u003d\"/profile/lunawyll\" title\u003d\"Эксперт lunawyll\"\u003elunawyll\u003c/a\u003e наткнулась на прикольное поведение c++11. Попробуйте угадать, что будет выведено, если использовать c++11?\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e#include \u0026lt;set\u0026gt;\n#include \u0026lt;iostream\u0026gt;\n\nusing namespace std;\n\nstruct S {\n    int a;\n    int b;\n    \n    S(int a \u003d 0, int b \u003d 0): a(a), b(b) {};\n\n    friend bool operator \u0026lt; (const S\u0026amp; first, const S\u0026amp; second) {\n        return first.a \u0026lt; second.a;\n    }\n};\n\nint main() {\n    set\u0026lt;S\u0026gt; s;\n    s.insert({2, 1});\n    cout \u0026lt;\u0026lt; s.size();\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eНеожиданный результат, но в сет будет добавлено 2 элемента (a\u003d2, b\u003d0) и (a\u003d1, b\u003d0).\u003c/p\u003e\u003cp\u003eПочему это так? Дело в том, что в c++11 был добавлен еще один метод \u003ccode\u003evoid insert (initializer_list\u0026lt;value_type\u0026gt; il);\u003c/code\u003e. Получается, что {2, 1} преобразуется в \u003ccode\u003einitializer_list\u0026lt;S\u0026gt;\u003c/code\u003e с двумя элементами (a\u003d2, b\u003d0) и (a\u003d1, b\u003d0) с помощью неявного преобразования int в S, используя конструктор, который мы описали.\u003c/p\u003e\u003cp\u003eGNU g++ 4.9.2 (не c++11): в сете будет один элемент (a\u003d2, b\u003d1).\u003c/p\u003e\u003cp\u003eMS VC++ 2010: ошибка компиляции.\u003c/p\u003e\u003cp\u003eВсем добра! :)\u003c/p\u003e\u003cp\u003eP.S. Каким-то образом я умудрился удалить пост, написал его заного...\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eUPD:\u003c/strong\u003e О том, как я удалил пост. В английской версии сайта при редактировании поста есть кнопочка \u0026quot;discard\u0026quot; — это разве не переводится как \u0026quot;отмена\u0026quot;? Оказалось — \u0026quot;удалить\u0026quot;.\u003c/p\u003e\u003c/div\u003e","tags":["c++11","o0"]}}