{"status":"OK","result":{"originalLocale":"en","allowViewHistory":true,"creationTimeSeconds":1468060811,"rating":5,"authorHandle":"I_love_Hoang_Yen","modificationTimeSeconds":1468091137,"id":45961,"title":"\u003cp\u003eTH Training 4 — Solutions\u003c/p\u003e","locale":"en","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003e\u003ca href\u003d\"https://www.youtube.com/watch?v\u003dwQzI2on9tcM\"\u003eVideo\u003c/a\u003e \u003ca href\u003d\"https://docs.google.com/presentation/d/1Nx8m3_nMIkgT6Vx24pVhVqAoYWJ2f6UXGbo0KHDJl_g/edit?usp\u003dsharing\"\u003eSlides\u003c/a\u003e\u003c/p\u003e\u003ch1\u003e\u003ca href\u003d\"/group/ThSS9mn0dy/contest/207844/problem/A\" title\u003d\"TH Training 4\"\u003e207844A - Đếm hình chữ nhật\u003c/a\u003e\u003c/h1\u003e\u003ch2\u003eQHĐ\u003c/h2\u003e\u003cp\u003eVới \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e là 1 hình chữ nhật, đặt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e)\u003c/span\u003e là số hình chữ nhật lồng nhau lớn nhất bên trong nó.\u003c/p\u003e\u003cp\u003eRõ ràng, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e) \u003d 1 + \u003ci\u003emax\u003c/i\u003e(\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e\u0027))\u003c/span\u003e với \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u0027\u003c/span\u003e là 1 hình chữ nhật nằm trong \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eVới mỗi hình chữ nhật \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e, để tính \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003c/span\u003e của tất cả \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e và các hình chữ nhật bên trong \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e, ta mất số phép tính bằng diện tích của \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eTa hình dung như sau:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eTa có 1 tờ giấy tượng trưng cho bảng ban đầu\u003c/li\u003e   \u003cli\u003eMỗi lần tính xong \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e)\u003c/span\u003e, ta cắt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e khỏi tờ giấy\u003c/li\u003e   \u003cli\u003eNhư vậy, để tính \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e)\u003c/span\u003e, ta mất số phép tính bằng diện tích của \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e trừ diện tích các phần đã bị cắt đi\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eCách code: Để tính \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e)\u003c/span\u003e:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eTìm các hình chữ nhật con bên trong \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u003c/span\u003e\u003c/li\u003e   \u003cli\u003eGọi đệ quy tính \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e\u003c/span\u003e của các hình chữ nhật con\u003c/li\u003e   \u003cli\u003eXóa hình chữ nhật con, bằng cách dùng mảng next trên mỗi hàng\u003c/li\u003e \u003c/ul\u003e\u003ch2\u003eChú ý\u003c/h2\u003e\u003cp\u003eCái khó ở bài này là nhận thấy trạng thái quy hoạch động có thể là 1 khái niệm trừu tượng (hình chữ nhật), chứ không thể hình dung nó bởi các giá trị số (như kiểu các bài DP trên dãy số thông thường).\u003c/p\u003e\u003ch1\u003e\u003ca href\u003d\"/group/ThSS9mn0dy/contest/207844/problem/B\" title\u003d\"TH Training 4\"\u003e207844B - Lật xu\u003c/a\u003e\u003c/h1\u003e\u003ch2\u003eExpected value\u003c/h2\u003e\u003cp\u003eVới \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e\u003c/span\u003e là 1 biến, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e)\u003c/span\u003e là trung bình \u0026quot;có trọng số\u0026quot; của các biến. Cái này cũng có thể hình dung như giá trị trung bình có trọng số.\u003c/p\u003e\u003cp\u003eVí dụ:\u003c/p\u003e\u003cp\u003eCó 2 lớp học:\u003c/p\u003e \u003cul\u003e   \u003cli\u003elớp A có 40 học sinh và điểm trung bình là 5\u003c/li\u003e   \u003cli\u003elớp B có 30 học sinh và điểm trung bình là 6\u003c/li\u003e \u003c/ul\u003e\u003cp\u003e--\u0026gt; điểm trung bình của tất cả học sinh là:\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e(5 * 40 + 6 * 30) / (40 + 30) \u003d 5 * (40 / 70) + 6 * (30 / 70)\u003c/span\u003e\u003c/p\u003e\u003cp\u003eCác trọng số \u003cspan class\u003d\"tex-span\"\u003e40 / 70\u003c/span\u003e và \u003cspan class\u003d\"tex-span\"\u003e30 / 70\u003c/span\u003e được nhân thêm do số lượng trường hợp điểm 5 và 6 khác nhau.\u003c/p\u003e\u003ch2\u003eToán\u003c/h2\u003e\u003cp\u003eĐể tránh ngu vì thiếu hiểu biết, cần phải nắm rõ các khái niệm toán học. Khuyến khích đọc thêm tài liệu Toán về phần này, đây là 1 kiến thức không thể thiếu nếu các em học lên cao hơn về Khoa học máy tính.\u003c/p\u003e\u003cp\u003eĐể định nghĩa 1 cách toán học Expected value, mình cần giải thích 1 số khái niệm toán học trước. Xét bài toán tung 1 xúc sắc (6 mặt):\u003c/p\u003e \u003cul\u003e   \u003cli\u003eSample space: tập hợp tất cả các khả năng có thể xảy ra (tung xúc sắc thì có 6 khả năng)\u003c/li\u003e   \u003cli\u003eEvents: một tập hợp gồm 1 hoặc nhiều khả năng (ví dụ: event xúc sắc \u003d 1, event xúc sắc chẵn, ...)\u003c/li\u003e   \u003cli\u003eProbability: khả năng 1 event xảy ra.\u003c/li\u003e   \u003cli\u003eRandom Variable: Một biến mà giá trị của nó là random, nó có thể nhận các giá trị khác nhau với xác suất cho trước theo 1 hàm nào đó. Ví dụ:   \u003cul\u003e     \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e1\u003c/span\u003e là giá trị của xúc sắc.\u003c/li\u003e     \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e2\u003c/span\u003e là 2 lần giá trị xúc sắc (có thể viết \u003cspan class\u003d\"tex-span\"\u003e2 * \u003ci\u003eX\u003c/i\u003e1\u003c/span\u003e)\u003c/li\u003e     \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e3\u003c/span\u003e là bình phương giá trị xúc sắc\u003c/li\u003e     \u003cli\u003e...\u003c/li\u003e   \u003c/ul\u003e\u003c/li\u003e   \u003cli\u003eProbability space: bao gồm 3 cái sample space, events và probability của các event.\u003c/li\u003e \u003c/ul\u003e\u003ch2\u003eLinearity of Expectation\u003c/h2\u003e\u003cp\u003eLinearity of Expectation là kĩ năng quan trọng nhất khi làm các bài về Expected value.\u003c/p\u003e\u003cp\u003eVí dụ:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eTung 2 xúc sắc\u003c/li\u003e   \u003cli\u003eTính Expected value của tổng giá trị 2 xúc sắc.\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eXét riêng từng xúc sắc:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eĐặt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1)\u003c/span\u003e là expected value của giá trị xúc sắc 1\u003c/li\u003e   \u003cli\u003eĐặt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e2)\u003c/span\u003e là expected value của giá trị xúc sắc 2\u003c/li\u003e \u003c/ul\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1) \u003d \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e2) \u003d (1 / 6) * 1 + (1 / 6) * 2 + ... + (1 / 6) * 6 \u003d 3.5\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eLinearity of Expectation cho ta công thức vô cùng kỳ diệu sau:\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1 + \u003ci\u003eX\u003c/i\u003e2) \u003d \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1) + \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e2) \u003d 7\u003c/span\u003e.\u003c/p\u003e\u003cp\u003ePhát biểu chính xác:\u003c/p\u003e\u003cp\u003eNếu \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e1\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eX\u003c/i\u003e2\u003c/span\u003e, ..., \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eXk\u003c/i\u003e\u003c/span\u003e là các random variable có cùng probability space:\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1 * \u003ci\u003ea\u003c/i\u003e1 + \u003ci\u003eX\u003c/i\u003e2 * \u003ci\u003ea\u003c/i\u003e2 + ... + \u003ci\u003eXk\u003c/i\u003e * \u003ci\u003eak\u003c/i\u003e) \u003d \u003ci\u003ea\u003c/i\u003e1 * \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e1) + \u003ci\u003ea\u003c/i\u003e2 * \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e2) + ... + \u003ci\u003eak\u003c/i\u003e * \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eXk\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eChú ý rằng các variable không cần independent.\u003c/p\u003e\u003ch2\u003eBài toán\u003c/h2\u003e\u003cp\u003eGiờ quay lại bài toán. Xét lượt lật xu đầu tiên:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eTrước lần đầu tiên: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e ngửa, 0 úp\u003c/li\u003e   \u003cli\u003eLật \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e đồng xu\u003c/li\u003e   \u003cli\u003eĐặt ngửa \u003d 1, xấp \u003d 0\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eGiờ giả sử ta xét 1 đồng xu độc lập:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eNếu nó đang ngửa:   \u003cul\u003e     \u003cli\u003eVới xác suất \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, nó trở thành xấp\u003c/li\u003e     \u003cli\u003eVới xác suất \u003cspan class\u003d\"tex-span\"\u003e1 - \u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, nó trở thành ngửa.\u003c/li\u003e     \u003cli\u003eNhư vậy, với 1 đồng xu đang ngửa, ta có expected value của giá trị đồng xu sau khi thực hiện phép lật là: \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e) * 0 + (1 - \u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e) * 1\u003c/span\u003e.\u003c/li\u003e     \u003cli\u003eVới \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e đồng xu ngửa, tổng expected value của giá trị các đồng xu là \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e lần giá trị trên. Đây chính là số đồng xu ngửa sau lượt 1 (do mỗi đồng xu ngửa giá trị 1 và xấp giá trị 0).\u003c/li\u003e   \u003c/ul\u003e\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eĐể làm tổng quát cho \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e lượt, ta cần hiểu các điều sau:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eĐặt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e)\u003c/span\u003e là số xu ngửa, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e)\u003c/span\u003e là số xu xấp. Dễ thấy \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e) + \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e) \u003d \u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, theo cách hiểu \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e\u003c/span\u003e là giá trị trung bình. Cái này các em có thể chứng minh chặt chẽ theo định nghĩa của \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eĐặt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eH\u003c/i\u003e\u0027\u003c/span\u003e là số xu ngửa sau 1 lượt lật \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e xu. Theo logic tương tự 1 lượt và linearity of expectation:\u003c/li\u003e \u003c/ul\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e\u0027) \u003d \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eH\u003c/i\u003e) * (1 - \u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e) + \u003ci\u003eE\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e) * (\u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eChú ý phép nhân ở đây thực hiện được do \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eE\u003c/i\u003e\u003c/span\u003e là 1 số thực, và nó đại diện cho tổng các \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eprob\u003c/i\u003e * \u003ci\u003evalue\u003c/i\u003e\u003c/span\u003e. Do đó khi thực hiện phép nhân này bản chất có thể hiểu là ta đang lấy tổng nhiều cặp \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eprob\u003c/i\u003e * \u003ci\u003evalue\u003c/i\u003e\u003c/span\u003e rồi nhân với \u003cspan class\u003d\"tex-span\"\u003e(1 - \u003ci\u003eA\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003ch2\u003eCode\u003c/h2\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/vmiCwg\"\u003eRR\u003c/a\u003e\u003c/p\u003e\u003ch1\u003e\u003ca href\u003d\"/group/ThSS9mn0dy/contest/207844/problem/C\" title\u003d\"TH Training 4\"\u003e207844C - Đếm nghịch thế\u003c/a\u003e\u003c/h1\u003e\u003ch2\u003eĐếm nghịch thế\u003c/h2\u003e\u003cp\u003eGiả sử ta cần đếm số cặp nghịch thế của 1 dãy cho trước (không có thao tác thay đổi các số), thì ta có thể dễ dàng đếm bằng BIT:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003efor (i \u003d 0; i \u0026lt; n; ++i) {\n    bit.count(0, a[i] - 1);  // đếm số số trong khoảng [0, a[i])\n    bit.update(a[i], + 1);   // thêm 1 số có giá trị a[i]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eTruy vấn thay đổi\u003c/h2\u003e\u003cp\u003eBản chất của bài toán nghịch thế như trên là có 2 chiều: index và giá trị.\u003c/p\u003e\u003cp\u003eỞ cách đếm nghịch thế (offline) trên, ta xử lý lần lượt theo chiều index, nên có thể sử dụng CTDL 1D với chiều giá trị.\u003c/p\u003e\u003cp\u003eKhi thêm các truy vấn, thực chất bài toán trở thành 3D: thời gian, index và giá trị. Ta buộc phải xử lý theo trục thời gian, nên bài toán chỉ có thể đưa về 2D. Do đó cần sử dụng các CTDL 2D để giải quyết.\u003c/p\u003e\u003ch2\u003eCách 1: chia block\u003c/h2\u003e\u003cp\u003eChia dãy số thành \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e block, mỗi block có \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e phần tử. (Nói cách khác là \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e \u003d \u003ci\u003eN\u003c/i\u003e\u003c/span\u003e).\u003c/p\u003e\u003cp\u003eNói theo cách hiểu về chiều của bài toán, thì ta chia block để xử lý chiều index. Sau đó ta dùng BIT để quản lý chiều giá trị.\u003c/p\u003e\u003cp\u003eNghĩa là:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eChia dãy thành \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e block, mỗi block gồm \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e phần tử\u003c/li\u003e   \u003cli\u003eỞ mỗi block, dùng 1 BIT để quản lý các số.\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eBan đầu, ta khởi tạo số nghịch thế của dãy, và với mỗi block, ta thêm các số của block đó vào trong BIT:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003efor (block \u003d 0; block \u0026lt; K; ++block) {\n    int from \u003d block * K, to \u003d from + K - 1;  // chú ý khi code thật phải cẩn thận `to` nhảy ra ngoài mảng (\u0026gt; N)\n    for (int i \u003d from; i \u0026lt;\u003d to; ++i) {\n        bit[block].update(a[i]);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eMỗi khi sửa 1 số \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e) \u003d \u003ci\u003eY\u003c/i\u003e\u003c/span\u003e, xét các cặp nghịch thế bị thay đổi (thêm vào hoặc mất đi)\u003c/p\u003e \u003cul\u003e   \u003cli\u003eGọi \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eV\u003c/i\u003e\u003c/span\u003e là giá trị cũ của \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e)\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eBlock trước \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eblock\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e)\u003c/span\u003e, bỏ đi các số lớn hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eV\u003c/i\u003e\u003c/span\u003e, thêm vào các số lớn hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eY\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eBlock sau \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eblock\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e)\u003c/span\u003e, bỏ đi các số nhỏ hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eV\u003c/i\u003e\u003c/span\u003e, thêm vào các số nhỏ hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eY\u003c/i\u003e\u003c/span\u003e.\u003c/li\u003e   \u003cli\u003eVới \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eblock\u003c/i\u003e(\u003ci\u003eX\u003c/i\u003e)\u003c/span\u003e, ta làm tương tự 2 trường hợp trên.\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eĐến đây, các thao tác đều đưa về 1D.\u003c/p\u003e\u003ch2\u003eCách 2: Cây trong cây\u003c/h2\u003e\u003cp\u003eBIT1D:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003eint get1D(int u) { // lấy đoạn 1 - u\n    int res \u003d 0;\n    for(; u \u0026gt; 0; u -\u003d u \u0026amp; -u) {\n        res +\u003d node[u];\n    }\n    return res;\n}\n\nvoid update1D(int u, int val) { // cập nhật vị trí u\n    for(; u \u0026lt; n; u +\u003d u \u0026amp; -u) {\n        node[u] +\u003d val;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eHình dung: mỗi nút của BIT là 1 cây BIT. Từ đó ta có thể code lại các thao tác update và get như sau:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003eint get2D(int u, int v) {  // lấy tổng hình chữ nhật (1, 1) - (u, v)\n    int res \u003d 0;\n    for (; u \u0026gt; 0; u -\u003d u \u0026amp; -u) {  // đang xét đến cây u\n        for(int x \u003d v; x \u0026gt; 0; x -\u003d x \u0026amp; -x) { // xét trên cây node[u]\n            res +\u003d node[u][v];\n        }\n    }\n    return res;\n}\nvoid update2D(int u, int v, int val) { // cập nhật điểm (u, v)\n    for(; u \u0026lt; n; u +\u003d u \u0026amp; -u) {  // đang xét cây u\n        for(int x \u003d v; x \u0026lt; n; x +\u003d x \u0026amp; -x) {\n            node[u][v] +\u003d val;\n        }\n    }\n}\n\n// node[u][v] là 1 cấu trúc dữ liệu kiểu mảng 2D, ví dụ có thể dùng map \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eCài đặt như trên bị lợn, do mảng node quá lớn (hoặc nếu dùng map thì bị thêm log). Ngoài ra số nút truy cập vào cũng nhiều hơn cần thiết.\u003c/p\u003e\u003cp\u003eĐể giảm độ phức tạp, ta chỉ xét những nút cần động vào. Để làm được việc này, ta cần biết trước tất cả các truy vấn mà ta sẽ phải thực hiện, sau đó chỉ thêm các nút cần thiết vào cây:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003evoid fakeUpdate(int u, int v) {\n    for(int x \u003d u; x \u0026lt;\u003d n; x +\u003d x \u0026amp; -x)\n        nodes[x].push_back(v);\n}\n\nvoid fakeGet(int u, int v) {\n    for(int x \u003d u; x \u0026gt; 0; x -\u003d x \u0026amp; -x)\n        nodes[x].push_back(v);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e2 hàm fakeUpdate và fakeGet tạo ra tất cả các nút cần thiết.\u003c/p\u003e\u003cp\u003eSau đấy, để thực hiện truy vấn thì ta làm kiểu này:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003evoid update(int u, int v) {\n    for(int x \u003d u; x \u0026lt;\u003d n; x +\u003d x \u0026amp; -x)\n        for(int y \u003d lower_bound(nodes[x].begin(), nodes[x].end(), v) - nodes[x].begin() + 1; y \u0026lt;\u003d nodes[x].size(); y +\u003d y \u0026amp; -y)\n            f[x][y]++;\n}\n\nint get(int u, int v) {\n    int res \u003d 0;\n    for(int x \u003d u; x \u0026gt; 0; x -\u003d x \u0026amp; -x)\n        for(int y \u003d upper_bound(nodes[x].begin(), nodes[x].end(), v) - nodes[x].begin(); y \u0026gt; 0; y -\u003d y \u0026amp; -y)\n            res +\u003d f[x][y];\n    return res;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eChú ý là sau khi tìm được tất cả các nút cần truy vấn, ta nén lại (đánh số từ 1 đến số nút trên mỗi cây BIT), và từ đó thực hiện truy vấn nhanh chóng.\u003c/p\u003e\u003ch1\u003e\u003ca href\u003d\"/group/ThSS9mn0dy/contest/207844/problem/D\" title\u003d\"TH Training 4\"\u003e207844D - Dãy bit kỳ diệu\u003c/a\u003e\u003c/h1\u003e\u003ch2\u003ePhân tích\u003c/h2\u003e\u003cp\u003eĐiều kiện xâu kỳ diệu trong đề bài tương đương với: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] \u003d \u003ci\u003eS\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e + \u003ci\u003eM\u003c/i\u003e]\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eChú ý là việc chứng minh được điều này sẽ giúp chứng minh được thuật KMP của bài \u003ca href\u003d\"/group/ThSS9mn0dy/contest/207665/problem/B\" title\u003d\"TH Training 3\"\u003e207665B - Xử lý xâu\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eXét 2 trường hợp:\u003c/p\u003e \u003cul\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e lớn hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/span\u003e\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e nhỏ hơn \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/span\u003e\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eChứng minh bám theo định nghĩa trong đề bài, suy ra \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] \u003d \u003ci\u003eS\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e + \u003ci\u003eM\u003c/i\u003e]\u003c/span\u003e.\u003c/p\u003e\u003ch2\u003eCách làm\u003c/h2\u003e\u003cp\u003eXét riêng 2 trường hợp: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e ≤ 17\u003c/span\u003e và \u003cspan class\u003d\"tex-span\"\u003e17 \u0026lt; \u003ci\u003eM\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e \u003cul\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e ≤ 17\u003c/span\u003e: duyệt \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e ký tự đầu. Với mỗi nhóm \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e * \u003ci\u003eM\u003c/i\u003e\u003c/span\u003e ký tự, ta phải đổi nó thành toàn 0 hoặc toàn 1. Từ đó quy hoạch động được: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003ei\u003c/i\u003e, 0)\u003c/span\u003e là chi phí nhỏ nhất để đổi \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e nhóm đầu tiên về toàn 0, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ef\u003c/i\u003e(\u003ci\u003ei\u003c/i\u003e, 1)\u003c/span\u003e là chi phí nhỏ nhất để đổi \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e nhóm đầu về toàn 1.\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e17 \u0026lt; \u003ci\u003eM\u003c/i\u003e\u003c/span\u003e: có không quá 17 nhóm. Duyệt các phép lật \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e * \u003ci\u003eM\u003c/i\u003e\u003c/span\u003e bit. Sau đó ta chỉ còn có thể lật từng bit một. Từ đó dễ dàng tham để tìm kết quả.\u003c/li\u003e \u003c/ul\u003e\u003c/div\u003e","tags":[]}}