{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":false,"creationTimeSeconds":1507466597,"rating":0,"authorHandle":"Slamur","modificationTimeSeconds":1507466597,"id":55069,"title":"\u003cp\u003eОптимизация. Префикс-массив\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003eВ данном посте я бы хотел рассмотреть один из самых простейших оптимизационных приемов, связанных с массивами. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eВ дальнейшем я буду опираться на то, что вы уже знакомы со следующими постами:\u003c/p\u003e \u003cul\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/group/XWOeQO4RLM/blog/entry/1847\"\u003eТипы данных\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/group/XWOeQO4RLM/blog/entry/1848\"\u003eОценка времени работы и расходуемой памяти\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/group/XWOeQO4RLM/blog/entry/1866\"\u003eМассив и список\u003c/a\u003e (интересует часть про массив)\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eНачнем мы с самой классической задачи на данный прием:\u003c/p\u003e\u003ch4\u003eЗадача 1.\u003c/h4\u003e\u003cp\u003e\u0026quot;Задан массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e из \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e целых чисел \u003cspan class\u003d\"tex-span\"\u003e(1 ≤ \u003ci\u003eN\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e, 1 ≤ \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] ≤ 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e)\u003c/span\u003e. \u003cbr /\u003e Требуется вывести ответы на каждый из \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eQ\u003c/i\u003e\u003c/span\u003e \u003cspan class\u003d\"tex-span\"\u003e(1 ≤ \u003ci\u003eQ\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e)\u003c/span\u003e запросов \u003cbr /\u003e \u0027Сумма элементов на отрезке \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e... \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u0027: \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e + 1] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e]\u003c/span\u003e.\u0026quot; \u003cbr /\u003e \u003cbr /\u003e\u003c/p\u003e\u003ch4\u003eРешение 1.1\u003c/h4\u003e\u003cp\u003eСамый простой вариант, который можно предложить, заключается в честном подсчете ответа на каждый запрос с помощью итерации по отрезку:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tДля каждого запроса (l, r) {\n\t\tСумма \u003d 0\n\t\tДля каждого индекса i от l до r {\n\t\t\tСумма \u003d Сумма + a[i]\n\t\t}\n\t\tВывести(Сумма)\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eБудем оценивать каждое решение по 4-м основным критериям: \u003c/p\u003e \u003col\u003e   \u003cli\u003e\u003cem\u003eКорректность\u003c/em\u003e — ответ всегда получается правильным — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eДополнительная память\u003c/em\u003e — мы не расходуем вообще никакой дополнительной памяти, кроме нескольких переменных — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eВремя работы (количество операций)\u003c/em\u003e — мы не укладываемся в ограничение по времени (обычно равен 1 или 2 секундам) — \u003cstrong\u003eFAIL\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eПростота реализации\u003c/em\u003e (дополнительный критерий) — реализация очень проста, без подводных камней — \u003cstrong\u003eОК\u003c/strong\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eДавайте разбираться, почему текущее решение слишком медленное. \u003cbr /\u003e Мы выполняем \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eQ\u003c/i\u003e\u003c/span\u003e запросов, в худшем случае вычисление ответа на каждый запрос выполняется за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e операций, \u003cbr /\u003e откуда общая оценка количества операций (сложность) решения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eQ\u003c/i\u003e·\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e. \u003cbr /\u003e Подставляя максимальные значения из ограничений, получаем, что на максимальном тесте мы выполняем порядка \u003cspan class\u003d\"tex-span\"\u003e10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e·10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e \u003d 10\u003csup class\u003d\"upper-index\"\u003e12\u003c/sup\u003e\u003c/span\u003e операций, \u003cbr /\u003e что сильно больше секунды (я бы сказал, что это уже тянет на несколько минут). \u003cbr /\u003e\u003c/p\u003e\u003ch4\u003eРешение 1.2\u003c/h4\u003e\u003cp\u003eЯ честно могу предложить очень много различных способов оптимизации, которые вы бы назвали \u0026quot;шаманствами\u0026quot;, \u003cbr /\u003e но их я буду обсуждать в постах, посвященных данным шаманствам. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eДавайте аккуратно рассмотрим сумму, которую мы хотим посчитать:\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e... \u003ci\u003er\u003c/i\u003e] \u003d \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e + 1] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u003c/p\u003e\u003cp\u003eХм, не видно ничего особого, что могло бы нам помочь. \u003cbr /\u003e Воспользуемся основным инструментом решения задач: получим что-нибудь ценное из ничего: \u003cbr /\u003e\u003c/p\u003e \u003col\u003e   \u003cli\u003eДобавим к массиву элемент A[0] \u003d 0 — запросов с ним нет, суммы он не изменяет.\u003c/li\u003e   \u003cli\u003eРаспишем математическое \u0026quot;ничего\u0026quot; как \u003cspan class\u003d\"tex-span\"\u003e0 \u003d (\u003ci\u003eA\u003c/i\u003e[0] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e - 1]) - (\u003ci\u003eA\u003c/i\u003e[0] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e - 1])\u003c/span\u003e \u003cbr /\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eПодставим данное \u0026quot;ничего\u0026quot; в наше выражение суммы: \u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e... \u003ci\u003er\u003c/i\u003e] \u003d (\u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e + 1] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e]) + 0 \u003d \u003c/span\u003e \u003cbr /\u003e \u003cspan class\u003d\"tex-span\"\u003e \u003d (\u003ci\u003eA\u003c/i\u003e[0] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e - 1] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e + 1] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e]) - (\u003ci\u003eA\u003c/i\u003e[0] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e - 1]) \u003d \u003c/span\u003e \u003cbr /\u003e \u003cspan class\u003d\"tex-span\"\u003e \u003d \u003ci\u003eS\u003c/i\u003e[0... \u003ci\u003er\u003c/i\u003e] - \u003ci\u003eS\u003c/i\u003e[0... \u003ci\u003el\u003c/i\u003e - 1]\u003c/span\u003e\u003c/p\u003e\u003cp\u003eДавайте здесь остановимся и введем пару обозначений: префикс и суффикс массива.\u003c/p\u003e\u003cp\u003eЧто такое префикс? \u003cs\u003e \u0026quot;Это небо! Плачущее небо под ногами...\u0026quot; \u003c/s\u003e \u003cbr /\u003e В общем случае \u003cstrong\u003e\u003cem\u003eпрефиксом\u003c/em\u003e\u003c/strong\u003e длины \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e называют первые \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e элементов массива. \u003cbr /\u003e \u003cstrong\u003e\u003cem\u003eСуффиксом\u003c/em\u003e\u003c/strong\u003e длины \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e называют соответственно последние \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e элементов массива. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eТеперь мы можем заметить, что если мы обозначим \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] \u003d \u003ci\u003eS\u003c/i\u003e[0... \u003ci\u003ei\u003c/i\u003e]\u003c/span\u003e, \u003cbr /\u003e то по факту \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e]\u003c/span\u003e хранит в себе сумму на префиксе длины \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e. \u003cbr /\u003e Массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e\u003c/span\u003e называют массивом \u0026quot;префикс-сумм\u0026quot;. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eВозвращаясь к нашей задаче, мы получили, что ответом на запрос \u0026quot;сумма на отрезке \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e... \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e\u0026quot; \u003cbr /\u003e является разность значений двух элементов массива \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e] - \u003ci\u003ePr\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e - 1]\u003c/span\u003e. \u003cbr /\u003e Получается, что, имея массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e\u003c/span\u003e, мы можем отвечать на каждый запрос за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(1)\u003c/span\u003e. Фантастика! \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eНаше решение будет выглядеть следующим образом:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tPr \u003d Вычисление массива префикс-сумм\n\n\tДля каждого запроса (l, r) {\n\t\tСумма \u003d Pr[r] - Pr[l - 1]\n\t\tВывести(Сумма)\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eОбщая сложность такого решения складывается из \u003c/p\u003e \u003cul\u003e   \u003cli\u003eсложности вычисления массива префикс-сумм, обозначим ее за $P(N);\u003c/li\u003e   \u003cli\u003eсложности ответа на \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eQ\u003c/i\u003e\u003c/span\u003e запросов, на каждый мы отвечаем за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(1)\u003c/span\u003e, откуда общая сложность \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e.\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eСуммарная сложность всего рещения получается \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) + \u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e. \u003cbr /\u003e Учитывая, что \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e довольно велико, хотелось бы, чтобы \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e было \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e или около того. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eВариант 1\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eДля начала рассмотрим простой способ вычисления массива \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e\u003c/span\u003e:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tДля каждого индекса i от 0 до N {\n\t\tPr[i] \u003d 0\n\t\tДля каждого индекса j от 0 до i {\n\t\t\tPr[i] \u003d Pr[i] + a[j]\n\t\t}\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eЕсли мы попробуем оценить суммарное количество итераций, то получим следующее:\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e1 + 2 + ... + (\u003ci\u003eN\u003c/i\u003e + 1) \u003d [(\u003ci\u003eN\u003c/i\u003e + 2)·(\u003ci\u003eN\u003c/i\u003e + 1)] / 2 \u003d \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e \u003cbr /\u003e (если вам непонятно, откуда взялась формула, почитайте про арифметические прогрессии).\u003c/p\u003e\u003cp\u003eУчитывая, что \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e\u003c/span\u003e, то вычисление префикс-сумм данным способом потребует порядка \u003cspan class\u003d\"tex-span\"\u003e10\u003csup class\u003d\"upper-index\"\u003e12\u003c/sup\u003e\u003c/span\u003e операций. \u003cbr /\u003e Получается, что мы оптимизировали ответы на запросы, но зато так замедлили часть решения до запросов, что даже не успели к ним приступить. \u003cbr /\u003e\u003c/p\u003e\u003cp\u003eЧто же делать?\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eВариант 2\u003c/strong\u003e\u003c/p\u003e \u003col\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e[0] \u003d \u003ci\u003eA\u003c/i\u003e[0] \u003d 0\u003c/span\u003e — сумма \u003cspan class\u003d\"tex-span\"\u003e0\u003c/span\u003e элементов массива равна \u003cspan class\u003d\"tex-span\"\u003e0\u003c/span\u003e по определению.\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] \u003d \u003ci\u003eA\u003c/i\u003e[0] + \u003ci\u003eA\u003c/i\u003e[1] + ... + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e - 1] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] \u003d \u003ci\u003ePr\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e - 1] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e]\u003c/span\u003e\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eОказывается, что мы можем посчитать весь массив префикс-сумм за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e одной итерацией цикла:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tPr[0] \u003d 0\n\t\n\tДля каждого индекса i от 1 до N {\n\t\tPr[i] \u003d Pr[i - 1] + a[i]\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eЛегко понять, что сложность данного кода — \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eДавайте запишем итоговый вариант нашего решения задачи:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tPr[0] \u003d 0\n\t\n\tДля каждого индекса i от 1 до N {\n\t\tPr[i] \u003d Pr[i - 1] + a[i]\n\t}\t\n\n\tДля каждого запроса (l, r) {\n\t\tСумма \u003d Pr[r] - Pr[l - 1]\n\t\tВывести(Сумма)\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eПо уже полученным выше оценкам, суммарная сложность такого решения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e + \u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e, что при \u003cspan class\u003d\"tex-span\"\u003e1 ≤ \u003ci\u003eN\u003c/i\u003e, \u003ci\u003eQ\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e\u003c/span\u003e легко укладывается в 1 секунду.\u003c/p\u003e\u003cp\u003eИтого:\u003c/p\u003e \u003col\u003e   \u003cli\u003e\u003cem\u003eКорректность\u003c/em\u003e — ответ всегда получается правильным — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eДополнительная память\u003c/em\u003e — мы используем дополнительный массив длины \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, откуда общая память \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) + \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) \u003d \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eВремя работы (количество операций)\u003c/em\u003e — сложность нашей программы \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e + \u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e, что с легкостью укладывается в ограничения по времени — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eПростота реализации\u003c/em\u003e (дополнительный критерий) — реализация очень проста, не сложнее решения 1 — \u003cstrong\u003eОК\u003c/strong\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003e\u003cstrong\u003eЗамечание\u003c/strong\u003e: помните, что хотя все элементы массива не выходят за 32-битный тип данных, но их сумма (в худшем случае \u003cspan class\u003d\"tex-span\"\u003e10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e * 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e \u003d 10\u003csup class\u003d\"upper-index\"\u003e15\u003c/sup\u003e\u003c/span\u003e) требует уже 64-битный тип данных. \u003cbr /\u003e Соответственно и тип переменной \u0026quot;Сумма\u0026quot;, и тип элементов массива \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ePr\u003c/i\u003e\u003c/span\u003e должен быть 64-битным.\u003c/p\u003e\u003ch4\u003eЗадача 2.\u003c/h4\u003e\u003cp\u003e\u0026quot;Задан массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e из \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e целых чисел \u003cspan class\u003d\"tex-span\"\u003e(1 ≤ \u003ci\u003eN\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e,  - 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e ≤ \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] ≤ 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e)\u003c/span\u003e. \u003cbr /\u003e Требуется вывести ответы на каждый из \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eQ\u003c/i\u003e\u003c/span\u003e \u003cspan class\u003d\"tex-span\"\u003e(1 ≤ \u003ci\u003eQ\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e)\u003c/span\u003e запросов \u003cbr /\u003e \u0027Произведение минимального элемента среди \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[1]... \u003ci\u003eA\u003c/i\u003e[\u003ci\u003el\u003c/i\u003e]\u003c/span\u003e и максимального среди \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[\u003ci\u003er\u003c/i\u003e]... \u003ci\u003eA\u003c/i\u003e[\u003ci\u003en\u003c/i\u003e]\u003c/span\u003e.\u0026quot; \u003cbr /\u003e\u003c/p\u003e\u003ch4\u003eРешение 2.1\u003c/h4\u003e\u003cp\u003eОпять же, простейший вариант решения заключается в честном подсчете ответа на каждый запрос с помощью итераций по двум отрезкам:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tДля каждого запроса (l, r) {\n\t\tМинимум \u003d A[1]\n\t\tДля каждого индекса i от 1 до l\t{\n\t\t\tМинимум \u003d min(Минимум, a[i])\n\t\t}\n\t\t\n\t\tМаксимум \u003d A[r]\n\t\tДля каждого индекса i от r до n\t{\n\t\t\tМаксимум \u003d max(Максимум, a[i])\n\t\t}\n\t\t\n\t\tПроизведение \u003d Минимум * Максимум\n\t\tВывести(Произведение)\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eОценим решение. Здесь можно процитировать решение 1.1:\u003c/p\u003e\u003cp\u003e--- Начало цитаты ---\u003c/p\u003e \u003col\u003e   \u003cli\u003e\u003cem\u003eКорректность\u003c/em\u003e — ответ всегда получается правильным — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eДополнительная память\u003c/em\u003e — мы не расходуем вообще никакой дополнительной памяти, кроме нескольких переменных — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eВремя работы (количество операций)\u003c/em\u003e — мы не укладываемся в ограничение по времени (обычно равен 1 или 2 секундам) — \u003cstrong\u003eFAIL\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eПростота реализации\u003c/em\u003e (дополнительный критерий) — реализация очень проста, без подводных камней — \u003cstrong\u003eОК\u003c/strong\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003eДавайте разбираться, почему текущее решение слишком медленное. \u003cbr /\u003e Мы выполняем \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eQ\u003c/i\u003e\u003c/span\u003e запросов, в худшем случае вычисление ответа на каждый запрос выполняется за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e операций, \u003cbr /\u003e откуда общая оценка количества операций (сложность) решения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eQ\u003c/i\u003e·\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e. \u003cbr /\u003e Подставляя максимальные значения из ограничений, получаем, что на максимальном тесте мы выполняем порядка \u003cspan class\u003d\"tex-span\"\u003e10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e·10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e \u003d 10\u003csup class\u003d\"upper-index\"\u003e12\u003c/sup\u003e\u003c/span\u003e операций, \u003cbr /\u003e что сильно больше секунды (я бы сказал, что это уже тянет на несколько минут).\u0026quot; \u003cbr /\u003e\u003c/p\u003e\u003cp\u003e--- Конец цитаты ---\u003c/p\u003e\u003cp\u003eНет смысла что-то дополнять, все совпадает.\u003c/p\u003e\u003ch4\u003eРешение 2.2\u003c/h4\u003e\u003cp\u003eОбратим наше внимание на одну интересную особенность задачи 2: все отрезки представляют собой префиксы или суффиксы массива. \u003cbr /\u003e Почему так? Просто потому, что идея, рассматриваемая в данном посте, способна вычислять значения на \u0026quot;внутренних\u0026quot; отрезках только для обратимых операций:\u003c/p\u003e \u003cul\u003e   \u003cli\u003eСложение (вычитание)\u003c/li\u003e   \u003cli\u003eУмножение (деление) — помните про возможное переполнение\u003c/li\u003e   \u003cli\u003eИ т.д., и т.п...\u003c/li\u003e \u003c/ul\u003e\u003cp\u003eНо вот посчитать значения на префиксах и суффиксах нам никто не запрещает, для этого функция лишь должна обладать свойством\u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eG\u003c/i\u003e(1..\u003ci\u003eK\u003c/i\u003e) \u003d \u003ci\u003eF\u003c/i\u003e(\u003ci\u003eG\u003c/i\u003e(1..\u003ci\u003eK\u003c/i\u003e - 1), \u003ci\u003eA\u003c/i\u003e[\u003ci\u003eK\u003c/i\u003e])\u003c/span\u003e, где F — функция \u0026quot;объединения\u0026quot; (в первой задаче это была операция сложения).\u003c/p\u003e\u003cp\u003eЯ думаю, что если вы разобрались с решением первой задачи, то с легкостью догадались, как решается данная задача: \u003cbr /\u003e нам помогут массивы префикс-минимумов и суффикс-максимумов:\u003c/p\u003e \u003cpre\u003e\u003ccode\u003e\tPrefMin[1] \u003d A[1]\n\tДля каждого индекса i от 2 до N\t{\n\t\tPrefMin[i] \u003d min(PrefMin[i - 1], a[i])\n\t}\n\t\n\tSuffMax[N] \u003d A[N]\n\tДля каждого индекса i от N - 1 до 1\t{\n\t\tSuffMax[i] \u003d max(SuffMax[i + 1], a[i])\n\t}\n\n\tДля каждого запроса (l, r) {\n\t\tМинимум \u003d PrefMin[l]\n\t\tМаксимум \u003d SuffMax[r]\n\t\t\n\t\tПроизведение \u003d Минимум * Максимум\n\t\tВывести(Произведение)\n\t}\t\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eCуммарная сложность такого решения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e + \u003ci\u003eN\u003c/i\u003e + \u003ci\u003eQ\u003c/i\u003e) \u003d \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e + \u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e, что при \u003cspan class\u003d\"tex-span\"\u003e1 ≤ \u003ci\u003eN\u003c/i\u003e, \u003ci\u003eQ\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e\u003c/span\u003e легко укладывается в 1 секунду.\u003c/p\u003e\u003cp\u003eИтого:\u003c/p\u003e \u003col\u003e   \u003cli\u003e\u003cem\u003eКорректность\u003c/em\u003e — ответ всегда получается правильным — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eДополнительная память\u003c/em\u003e — мы используем 2 дополнительных массива длины \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, откуда общая память \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) + \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) + \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e) \u003d \u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eВремя работы (количество операций)\u003c/em\u003e — сложность нашей программы \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e + \u003ci\u003eQ\u003c/i\u003e)\u003c/span\u003e, что с легкостью укладывается в ограничения по времени — \u003cstrong\u003eОК\u003c/strong\u003e;\u003c/li\u003e   \u003cli\u003e\u003cem\u003eПростота реализации\u003c/em\u003e (дополнительный критерий) — реализация очень проста, не сложнее решения 1 — \u003cstrong\u003eОК\u003c/strong\u003e.\u003c/li\u003e \u003c/ol\u003e\u003cp\u003e\u003cstrong\u003eЗамечание\u003c/strong\u003e: помните, что хотя все элементы массива не выходят за 32-битный тип данных (а значит минимум и максимум среди них тоже), \u003cbr /\u003e но их произведение (в худшем случае \u003cspan class\u003d\"tex-span\"\u003e10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e * 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e \u003d 10\u003csup class\u003d\"upper-index\"\u003e18\u003c/sup\u003e\u003c/span\u003e) требует уже 64-битный тип данных. \u003cbr /\u003e Соответственно тип переменной \u0026quot;Произведение\u0026quot;, а лучше и тип переменных \u0026quot;Минимум\u0026quot; и \u0026quot;Максимум\u0026quot;, должны быть 64-битными.\u003c/p\u003e\u003ch4\u003eЗадача 3 (Самостоятельная работа).\u003c/h4\u003e\u003cp\u003eЗадача для самостоятельного решения. Прошу писать ваши идеи решения мне в ВК. \u003cbr /\u003e \u003c/p\u003e\u003cp\u003e\u0026quot;Задан массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e\u003c/span\u003e из \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e целых чисел \u003cspan class\u003d\"tex-span\"\u003e(1 ≤ \u003ci\u003eN\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e,  - 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e ≤ \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] ≤ 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e)\u003c/span\u003e. \u003cbr /\u003e Требуется найти такую пару индексов \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ei\u003c/i\u003e, \u003ci\u003ej\u003c/i\u003e)\u003c/span\u003e, таких что:\u003c/p\u003e \u003cul\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e \u0026lt; \u003ci\u003ej\u003c/i\u003e\u003c/span\u003e;\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e]\u003c/span\u003e — четное;\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[\u003ci\u003ej\u003c/i\u003e]\u003c/span\u003e — нечетное;\u003c/li\u003e   \u003cli\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eA\u003c/i\u003e[\u003ci\u003ei\u003c/i\u003e] + \u003ci\u003eA\u003c/i\u003e[\u003ci\u003ej\u003c/i\u003e]\u003c/span\u003e максимально среди всех подходящих пар \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ei\u003c/i\u003e, \u003ci\u003ej\u003c/i\u003e)\u003c/span\u003e;\u003c/li\u003e   \u003cli\u003eЕсли возможно несколько решений, вывести любое;\u003c/li\u003e   \u003cli\u003eЕсли решений нет, выведите \u0026quot;-1 -1\u0026quot; без кавычек.\u003c/li\u003e \u003c/ul\u003e\u003ch4\u003eЗадачи на сайтах\u003c/h4\u003e\u003cp\u003eЗадачи необязательно посорчены по возрастанию сложности, прочтите и попробуйте решить каждую из них. \u003cbr /\u003e Если возникнут вопросы — не бросайте задачу насовсем, а задайте вопрос — в комментариях к посту или в ВК.\u003c/p\u003e \u003cul\u003e   \u003cli\u003e\u003ca href\u003d\"http://acm.timus.ru/problem.aspx?space\u003d1\u0026amp;num\u003d1330\"\u003eTimus. Интервалы\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/problemset/problem/588/A\"\u003eCodeforces. Duff и мясо\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/problemset/problem/313/B\"\u003eCodeforces. Илья и запросы\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"//codeforces.com/problemset/problem/368/B\"\u003eCodeforces. Сережа и суффиксы\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"http://contest.samara.ru/ru/problemset/6088/\"\u003eSamara school contests. Задача A. Действительно важные вещи\u003c/a\u003e — \u003ca href\u003d\"http://contest.samara.ru/pix/160207/contest-3648-ru.pdf\"\u003eСсылка на условие\u003c/a\u003e\u003c/li\u003e   \u003cli\u003e\u003ca href\u003d\"http://contest.samara.ru/ru/problemset/6052/\"\u003eSamara school contests. Задача С. Цвет победы\u003c/a\u003e\u003c/li\u003e \u003c/ul\u003e\u003c/div\u003e","tags":["самара","префикс-сумма"]}}