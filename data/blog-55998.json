{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":true,"creationTimeSeconds":1511608090,"rating":0,"authorHandle":"Coder_404","modificationTimeSeconds":1511608090,"id":55998,"title":"\u003cp\u003eLCA B-O(N) Q-O(log N)\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cpre\u003e\u003ccode\u003e#define N 211111\n\nint t[N * 4];\nVI order;\nint first[N];\nVI g[N];\nint h[N];\nint n;\nvoid DFS(int v, int p) {\n\tfirst[v] \u003d SZ(order);\n\torder.push_back(v);\n\th[v] \u003d h[p] + 1;\n\tfor (auto x : g[v]) {\n\t\tif (x !\u003d p) {\n\t\t\tDFS(x, v);\n\t\t\torder.push_back(v);\n\t\t}\n\t}\n}\nvoid build(int v, int tl, int tr) {\n\tif (tl \u003d\u003d tr) {\n\t\tt[v] \u003d order[tl];\n\t}\n\telse {\n\t\tint tm \u003d (tl + tr) \u0026gt;\u0026gt; 1;\n\t\tbuild(v + v, tl, tm);\n\t\tbuild(v + v + 1, tm + 1, tr);\n\t\tif (h[t[v + v]] \u0026lt; h[t[v + v + 1]]) t[v] \u003d t[v + v]; else t[v] \u003d t[v + v + 1];\n\t}\n}\n\nint get(int l, int r, int v, int tl, int tr) {\n\tif (l\u0026gt;tr || r \u0026lt; tl) return 0;\n\tif (l \u0026lt;\u003d tl\u0026amp;\u0026amp;tr \u0026lt;\u003d r) return t[v];\n\tint tm \u003d (tl + tr) / 2;\n\tint p1 \u003d get(l, r, v + v, tl, tm);\n\tint p2 \u003d get(l, r, v + v + 1, tm + 1, tr);\n\tif (h[p1] \u0026lt; h[p2])\n\t\treturn p1;\n\telse\n\t\treturn p2;\n}\n\nvoid solve()\n{\n\tcin \u0026gt;\u0026gt; n;\n\th[0] \u003d INF;\n\tREP(i, 1, n) {\n\t\tint a, b;\n\t\tcin \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b;\n\t\tg[a].push_back(b);\n\t\tg[b].push_back(a);\n\t}\n\th[1] \u003d -1;\n\torder.push_back(0);\n\tDFS(1, 1);\n\tbuild(1, 1, SZ(order) - 1);\n\tint a, b;\n\twhile (cin \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b) {\n\t\tint l \u003d first[a];\n\t\tint r \u003d first[b];\n\t\tif (l \u0026gt; r) swap(l, r);\n\t\tint lca\u003dget(l, r, 1, 1, SZ(order) - 1);\n\t\t//cout \u0026lt;\u0026lt; h[a] +h[b] - 2 * h[lca];\n\t\tcout \u0026lt;\u0026lt; \u0026quot;lca(a,b)\u003d\u0026quot; \u0026lt;\u0026lt; lca \u0026lt;\u0026lt; endl;\n\t}\n\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","tags":["sample code","lca"]}}