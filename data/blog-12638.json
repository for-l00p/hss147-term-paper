{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":false,"creationTimeSeconds":1402394470,"rating":45,"authorHandle":"Fefer_Ivan","modificationTimeSeconds":1402395102,"id":12638,"title":"\u003cp\u003eТип результата тернарного оператора в Java\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003eДобрый день.\u003c/p\u003e\u003cp\u003eСегодня я разбирался с NullPointerException, возникающим в API в крайне непонятном месте, и обнаружил, что следующий код ведет себя странно.\u003c/p\u003e \u003cpre\u003e\u003ccode\u003elong a \u003d 0; // primitive long\nLong b \u003d null; // Long object\nboolean s \u003d ???;\n\nLong c \u003d s ? a : b;\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eВыяснилось, что \u003ccode\u003es ? a : b\u003c/code\u003e эквивалентно \u003ccode\u003es ? a : (throw new NullPointerException)\u003c/code\u003e. И связано это с тем, что выражение \u003ccode\u003es ? a : b\u003c/code\u003e имело тип \u003cstrong\u003elong\u003c/strong\u003e, а не \u003cstrong\u003eLong\u003c/strong\u003e и так как переменная \u003ccode\u003eb\u003c/code\u003e имела значение \u003cstrong\u003enull\u003c/strong\u003e, то при попытке привести её к типу \u003cstrong\u003elong\u003c/strong\u003e возникал NPE. Такие дела. Баг я поправил так\u003c/p\u003e \u003cpre\u003e\u003ccode\u003eLong c \u003d s ? Long.valueOf(a) : b;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eС уважением, Иван.\u003c/p\u003e\u003cp\u003eP.S.\u003cbr /\u003eВсе как и написано в спецификации: \u003c/p\u003e \u003cul\u003e   \u003cli\u003eIf one of the second and third operands is of primitive type T, and the type of the other is the result of applying boxing conversion (§5.1.7) to T, then the type of the conditional expression is T.\u003c/li\u003e \u003c/ul\u003e\u003cp\u003e\u003ca href\u003d\"http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.25\"\u003ehttp://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.25\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e","tags":["java","exceptions"]}}