{"status":"OK","result":{"originalLocale":"en","allowViewHistory":false,"creationTimeSeconds":1407887362,"rating":60,"authorHandle":"Xellos","modificationTimeSeconds":1407919033,"id":13381,"title":"\u003cp\u003eTC SRM 629: A solution for div1 950pt\u003c/p\u003e","locale":"en","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003eThis was originally intended as an answer for \u003ca href\u003d\"//codeforces.com/blog/entry/13361#comment-182547\"\u003ethis comment\u003c/a\u003e, but eventually I realized that it\u0027s too long (also, the Preview feature takes way too long to process it), so it\u0027s a blog post instead.\u003c/p\u003e\u003cp\u003eThis has complexity of \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/39/a2/39a29ab403c91375cb921e23a933d31db4d429f4.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and a horrible constant. If there\u0027s a better solution, write it in the comments.\u003c/p\u003e\u003cp\u003eUPD: \u003ca class\u003d\"rated-user user-orange\" href\u003d\"/profile/KADR\" title\u003d\"Мастер KADR\"\u003eKADR\u003c/a\u003e provides a solution using polynomial interpolation in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eK\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e.\u003c/p\u003e\u003ch2\u003eProblem statement\u003c/h2\u003e\u003cp\u003eThere are \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e boxes numbered \u003cspan class\u003d\"tex-span\"\u003e1..\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e; box number \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e contains \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e candies and 1 stone. We pick 1 random object from each box. Calculate \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/5b/a8/5ba8b4207de4d6bcee01b1c7c088cdd9834c037e.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, where \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ep\u003c/i\u003e\u003c/span\u003e is the probability that \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e of these \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e objects are candies. \u003c/p\u003e\u003cp\u003eConstraints: \u003cspan class\u003d\"tex-span\"\u003e1 ≤ \u003ci\u003eK\u003c/i\u003e ≤ \u003ci\u003eN\u003c/i\u003e ≤ 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e2·10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e ≥ \u003ci\u003eM\u003c/i\u003e ≥ 10\u003csup class\u003d\"upper-index\"\u003e9\u003c/sup\u003e\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e is prime. \u003c/p\u003e\u003ch2\u003eSolution\u003c/h2\u003e\u003cp\u003eIt\u0027s clear that since the probability of picking a candy from box \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ek\u003c/i\u003e\u003c/span\u003e is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/11/35/11352105dfc52ec01261be8773d8ecae76de4c59.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and the probability of not picking one is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/1c/58/1c5889942a40adfc614fe94902fb4da02158215c.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, the answer is (\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e denotes the set \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/fe/21/fe21e1f7408b8843d1fd279cdbc54c1bfb64909d.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e)\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/6a/e7/6ae767bc06d081089cc0faafa5f89eb851617e3a.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003eLet\u0027s denote this sum as \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e and introduce another sum (\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/span\u003e is integer division)\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/b5/2c/b52c3ba976bc523e53508357cca1f40959597e34.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003ewhich calculates the same sum \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e, but with an additional restriction that \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e can only be subsets of range \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/77/b0/77b05684d8b07226cc289c48d265bfa386a065d0.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. \u003c/p\u003e\u003cp\u003eIf that restriction was instead that \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e can only be subsets of range \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/32/75/3275c4644715604143a9ed79be24e5a56bd66a45.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, the sum would obviously be just \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e / 2, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eAlso, let\u0027s denote \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/cd/37/cd378a52f4cdd11cb4bfe95f3d64bb05854ada5f.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003e\u003cstrong\u003eNaive solution\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eIf the constraints were small, we could use simple DP on \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e. If we don\u0027t use \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e, then we sum up \u003cspan class\u003d\"tex-span\"\u003eπ(\u003ci\u003eS\u003c/i\u003e\u0027)\u003c/span\u003e of the same subsets \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u0027\u003c/span\u003e as in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e - 1, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e. If \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/d5/c9/d5c9969a3b64074efe095808b617f7728f9f5b6c.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, we only need \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e - 1\u003c/span\u003e elements from the range \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eN\u003c/i\u003e - 1\u003c/sub\u003e\u003c/span\u003e, so we sum up \u003cspan class\u003d\"tex-span\"\u003eπ(\u003ci\u003eS\u003c/i\u003e) \u003d \u003ci\u003eN\u003c/i\u003eπ(\u003ci\u003eS\u003c/i\u003e\u0027)\u003c/span\u003e of the same subsets \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u0027\u003c/span\u003e as in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e - 1, \u003ci\u003eK\u003c/i\u003e - 1)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eThis runs in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eNK\u003c/i\u003e)\u003c/span\u003e and would obviously give TLE. What we can do instead is splitting the range \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e into 2 halves of size \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/span\u003e (and possibly 1 integer \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2 + 1\u003c/span\u003e in the center for odd \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e).\u003c/p\u003e\u003cp\u003e\u003cb\u003eCalculating \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e — even \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e \u003c/b\u003e\u003c/p\u003e\u003cp\u003eSuppose we knew how to calculate \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e(, )\u003c/span\u003e already. In order to calculate \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e for even \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, we can split any \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/04/2b/042b504400b949b86a22dc15b6bd4da0562a3980.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e disjointly and uniquely into \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/0f/5a/0f5a1b1a03e876dbda082854f82425a3997353a7.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e and \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/e3/7e/e37e9434356f99f7f0bea4d02bb6e2fc8ca3f3c7.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. \u003c/p\u003e\u003cp\u003eIf \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/sub\u003e| \u003d \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, then \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e| \u003d \u003ci\u003eK\u003c/i\u003e - \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e; any 2 sets \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e can be merged to form one set \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e and so we have for fixed \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/80/64/8064350061a4c13891157ebcdf64c1b2e292fb41.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003eSince \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e can be any integer in \u003cspan class\u003d\"tex-span\"\u003e[0, \u003ci\u003eK\u003c/i\u003e]\u003c/span\u003e, we get\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/82/ec/82ec67002bd340bbcc04bc492c4a6d512a30b41c.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003e\u003cb\u003eCalculating \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e — odd \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e \u003c/b\u003e\u003c/p\u003e\u003cp\u003eIn this case, we can again split \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e disjointly and uniquely into \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e as above and another set \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/83/2f/832fd282cff478e2535377b2ef6aba9652a53cfb.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. We have 2 choices for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e: either it\u0027s empty or contains \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2 + 1\u003c/span\u003e; if it\u0027s empty, then we get the same sum as for even \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eIf \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e is non-empty, we can again use that \u003cspan class\u003d\"tex-span\"\u003eπ(\u003ci\u003eS\u003c/i\u003e) \u003d π(\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/sub\u003e)π(\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e)π(\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ec\u003c/i\u003e\u003c/sub\u003e) \u003d π(\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/sub\u003e)π(\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/sub\u003e)(\u003ci\u003eN\u003c/i\u003e / 2 + 1)\u003c/span\u003e, where we can take \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 2 + 1\u003c/span\u003e out of the sum and get a similar sum as for even \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e — the only change is that if \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e1\u003c/sub\u003e| \u003d \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, then \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e| \u003d \u003ci\u003eK\u003c/i\u003e - 1 - \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e and\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/be/1b/be1b06d82a6e6cb6894db20636c64c5173cd2c6f.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003eAgain iterating over all \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e from 0 to \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e - 1\u003c/span\u003e, we get a formula for odd \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e:\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/9e/46/9e467ea56aa35b367b79711554b7904d9b906d6c.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003e\u003cb\u003eCalculating \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e \u003c/b\u003e\u003c/p\u003e\u003cp\u003eLet\u0027s expand the sum as\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/61/3d/613dfb7e47c9a6be1fc05225e7818edeaf1cf543.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/35/5d/355d76707d39d5f92e09f1b908d8b87866a96223.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003eIt\u0027s clear that if \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003eS\u003c/i\u003e\u0027| \u003d \u003ci\u003eK\u003c/i\u003e - \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e, then \u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/6e/01/6e018d5dc18f6a9d7fa0bf5f72ded65458684b92.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/6c/30/6c3056787820bd4e2c2aecc7590e334426435038.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003ewhere \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/20/19/20199cfe01e627ea8050e2aec243973c55c64333.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e denotes the number of sets \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e (of size \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e) satisfying the condition.\u003c/p\u003e\u003cp\u003eHow to count that number? We can just exclude set \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u0027\u003c/span\u003e from all \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/sub\u003e\u003c/span\u003e (since they all contain \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u0027\u003c/span\u003e); then, we can see that we just need to count the number of subsets of \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eS\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003eN\u003c/i\u003e / 2\u003c/sub\u003e\\ \u003ci\u003eS\u003c/i\u003e\u0027\u003c/span\u003e of size \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e. That\u0027s obviously just \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/d9/e2/d9e25158a27cf22d1f6132d88e8f48b45be2cf4a.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, so\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/be/cb/becb6a52ee7b62ff3dd28ed65fd184327e048899.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/8b/74/8b7488dd9764512eab6de7da669e973d902ecc48.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003e\u003cb\u003eBinomial coefficient\u003c/b\u003e\u003c/p\u003e\u003cp\u003eThe binomial coefficient has kinda big arguments, no? We can\u0027t just pre-compute a Pascal triangle or factorials, but \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e is sufficiently small, so we can just use one of the most basic formulas for binomial coefficients\u003c/p\u003e \u003ccenter\u003e\u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ff/38/ff3873fb69619db8797e895ca84f871734654ec3.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e\u003c/center\u003e\u003cp\u003eand so, for given \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e\u003c/span\u003e, compute the necessary binomial coefficients along with corresponding terms in the sum for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e. It\u0027s useful to have modular inverses precomputed; here, we can use that \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e is a prime larger than \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e, so by Fermat\u0027s little theorem, \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/2a/63/2a63aa6b399fb8225de8ec4c2da4a467d5ef5fc9.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003e\u003cb\u003eComplexity\u003c/b\u003e\u003c/p\u003e\u003cp\u003eWe now have a fairly simple way to compute \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e in \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eK\u003c/i\u003e)\u003c/span\u003e time with some pre-computation. The important thing is that thanks to integer division, the \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e in the argument can only be \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e from the input divided by powers of 2; since there are just \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/28/a3/28a3e1ebf443830c2b8d35cc88c49444739ab741.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e such powers that don\u0027t lead to the trivial case \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e \u003d 0\u003c/span\u003e, and with fixed \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, we only spend \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eK\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e time on computing \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e()\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e()\u003c/span\u003e for all possible \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e, the complexity is \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/39/a2/39a29ab403c91375cb921e23a933d31db4d429f4.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eThe limits are too tight, though — the biggest problem is there are a lot of modulos that take a lot of time. One possible improvement is only taking the modulo when computing the sums for \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e()\u003c/span\u003e and \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eP\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e2\u003c/sub\u003e()\u003c/span\u003e after every 4 additions, that gives me worst-case runtime of around 2.1 seconds (so close TLE T_T). Also, we can precompute \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/b5/4a/b54aadedf06bd06bd0eab52cb9c9caf2cc93d5eb.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e, which saves us some modulo operation compared to precomputing \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003eN\u003c/i\u003e + 1)\u003csup class\u003d\"upper-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sup\u003e\u003c/span\u003e and \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/c7/34/c73421117fbdc493889fc5af86a73a5c581e26d6.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e separately. \u003ca href\u003d\"http://ideone.com/wilEgP\"\u003eCode\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e","tags":["topcoder","srm","629","solution","hard"]}}