{"status":"OK","result":{"originalLocale":"ru","allowViewHistory":false,"creationTimeSeconds":1482935684,"rating":8,"authorHandle":"kefaa","modificationTimeSeconds":1482938977,"id":49366,"title":"\u003cp\u003eEditorial Contest 28.12.2016\u003c/p\u003e","locale":"ru","content":"\u003cdiv class\u003d\"ttypography\"\u003e\u003cp\u003eВсем спасибо за участие!) \u003c/p\u003e\u003cp\u003eДумаю, стоило бы выложить ссылки на задачи: \u003ca href\u003d\"http://dl.gsu.by/task.jsp?cid\u003d19\u0026amp;nid\u003d122829\"\u003eA и B\u003c/a\u003e; \u003ca href\u003d\"http://main.edu.pl/en/archive/oi/14/zap\"\u003eC и D\u003c/a\u003e; \u003ca href\u003d\"//codeforces.com/problemset/problem/475/E\"\u003eE\u003c/a\u003e; \u003ca href\u003d\"http://main.edu.pl/en/archive/oi/8/ant\"\u003eF, G и H\u003c/a\u003e, \u003ca href\u003d\"//codeforces.com/contest/27/problem/E\"\u003eи тут\u003c/a\u003e, \u003ca href\u003d\"//codeforces.com/gym/100467\"\u003eи еще А тут\u003c/a\u003e; \u003ca href\u003d\"http://main.edu.pl/en/archive/oi/21/pta\"\u003eI и J\u003c/a\u003e; \u003ca href\u003d\"http://dl.gsu.by/task.jsp?cid\u003d19\u0026amp;nid\u003d942760\"\u003eK, L и M\u003c/a\u003e\u003c/p\u003e\u003cp\u003eВ каждом разборе будет мой (быдло)код. Настоятельно рекомендую посмотреть все коды :)\u003c/p\u003e\u003cp\u003eЕсли непонятно все равно, пишите мне или победителю контеста \u003ca class\u003d\"rated-user user-violet\" href\u003d\"/profile/Vladik\" title\u003d\"Кандидат в мастера Vladik\"\u003eVladik\u003c/a\u003e\u0027у, он с радостью ответит на все ваши вопросы.\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/B\"\u003e210922B — Тестирование шаффл-машин\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eВ первой группе можно было просто промоделировать процесс. Думаю, с этим проблем не должно было возникнуть.\u003c/p\u003e\u003cp\u003eВо второй группе поступим так. Мы хотим узнать, какое число стоит на позиции \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ek\u003c/i\u003e\u003c/span\u003e после \u003cspan class\u003d\"tex-span\"\u003e|\u003ci\u003es\u003c/i\u003e|\u003c/span\u003e запросов. Давайте \u0026quot;отменим\u0026quot; этот запрос, то есть найдем, на какой позиции стояло число после предпоследней операции, если после последней операции оно переместилось на позицию \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ek\u003c/i\u003e\u003c/span\u003e. После этого отменим предпоследний запрос и так далее, до тех пор, пока не отменим все запросы.\u003c/p\u003e\u003cp\u003eДавайте посмотрим на то, как происходит U-преобразование для \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e \u003d 10\u003c/span\u003e:\u003c/p\u003e\u003cp\u003e1 2 3 4 5 6 7 8 9 10\u003c/p\u003e\u003cp\u003e1 6 2 7 3 8 4 9 5 10\u003c/p\u003e\u003cp\u003eМожно заметить, что если на позиции \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ep\u003c/i\u003e\u003c/span\u003e (1-индексация) в новой последовательности стоит число \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, то до преобразования оно находилось на позиции \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ep\u003c/i\u003e + 1) / 2\u003c/span\u003e, если \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ep\u003c/i\u003e\u003c/span\u003e нечетно и на позиции \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003en\u003c/i\u003e / 2 + \u003ci\u003ep\u003c/i\u003e / 2\u003c/span\u003e, если \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ep\u003c/i\u003e\u003c/span\u003e четно. \u003c/p\u003e\u003cp\u003eАналогично разбираются случаи для D-преобразования.\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/sEfD8a\"\u003eКод\u003c/a\u003e\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/D\"\u003e210922D — Дракон Федя и запросы\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eВ первой группе переберем все возможные пары \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ey\u003c/i\u003e\u003c/span\u003e и сравним их \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003egcd\u003c/i\u003e\u003c/span\u003e с числом \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003c/span\u003e. Асимптотика \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eT\u003c/i\u003e·\u003ci\u003ea\u003c/i\u003e·\u003ci\u003eb\u003c/i\u003e·\u003ci\u003elog\u003c/i\u003e(\u003ci\u003emin\u003c/i\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)))\u003c/span\u003e\u003c/p\u003e\u003cp\u003eРешим вторую группу.\u003c/p\u003e\u003cp\u003eСперва заметим, что количество пар \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ex\u003c/i\u003e, \u003ci\u003ey\u003c/i\u003e)\u003c/span\u003e с НОДом, равным \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003c/span\u003e, столько же, сколько и пар \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/68/0f/680f05bf1cb2ae1a3af705bfc64eddbfdf3c5626.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e с НОДом, равным \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e (просто домножим оба числа на \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003c/span\u003e и получим НОД, равный \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003c/span\u003e). Значит, наша задача сводится к ответу на новые \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eT\u003c/i\u003e\u003c/span\u003e запросов, для каждого из которых \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e \u003d 1\u003c/span\u003e\u003c/p\u003e\u003cp\u003eПодзадача: зная ответ для некоторого запроса \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e научиться за хорошую асимптотику искать ответы для любого из запросов \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e - 1, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e + 1, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e - 1)\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e + 1)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eПусть мы знаем ответ для запроса \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e и хотим посчитать ответ для запроса \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e + 1, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e. Какие новые (то есть те, которые мы не учитываем в ответе для \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e) пары \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ex\u003c/i\u003e, \u003ci\u003ey\u003c/i\u003e)\u003c/span\u003e могли добавиться? Только такие, для которых \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ex\u003c/i\u003e \u003d \u003ci\u003ea\u003c/i\u003e + 1\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e1 ≤ \u003ci\u003ey\u003c/i\u003e ≤ \u003ci\u003eb\u003c/i\u003e\u003c/span\u003e и \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003egcd\u003c/i\u003e(\u003ci\u003ex\u003c/i\u003e, \u003ci\u003ey\u003c/i\u003e) \u003d 1\u003c/span\u003e. То есть для заданных \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e и \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/span\u003e необходимо научиться считать количество таких чисел \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eK\u003c/i\u003e\u003c/span\u003e, что \u003cspan class\u003d\"tex-span\"\u003e1 ≤ \u003ci\u003eK\u003c/i\u003e ≤ \u003ci\u003eM\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003egcd\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e, \u003ci\u003eK\u003c/i\u003e) \u003d 1\u003c/span\u003e. Здесь нам поможет \u003ca href\u003d\"http://e-maxx.ru/algo/inclusion_exclusion_principle#11\"\u003eпринцип включений-исключений\u003c/a\u003e. Аналогично нужно будет отнять/прибавить необходимые значения для переходов в \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e - 1, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e - 1)\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e + 1)\u003c/span\u003e\u003c/p\u003e\u003cp\u003eПусть \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/48/4a/484aa30feb71bd0f99d50e0bb711716c8925d814.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e. Давайте все запросы распределим по блокам. Будем говорить, что некоторый запрос \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003ea\u003c/i\u003e, \u003ci\u003eb\u003c/i\u003e)\u003c/span\u003e принадлежит блоку с номером \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e \u003ci\u003ediv\u003c/i\u003e \u003ci\u003eP\u003c/i\u003e\u003c/span\u003e. Внутри одного блока отсортируем все запросы во возрастанию числа \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/span\u003e (независимо от значения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e). Тогда давайте обрабатывать запросы в таком порядке: сначала все запросы в первом блоке, затем все во втором и так далее (внутри блока мы уже посортили по \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/span\u003e). Для этого будем хранить последний запрос и ответ на него. Чтобы ответить на следующий запрос, будем изменять на единицу нужную границу последнего запроса и пересчитывать ответ(мы уже научились это делать, решив подзадачу) до тех пор, пока не получим необходимый запрос. Таким образом, мы сможем получить ответ на каждый запрос, осталось только вывести их в порядке, в котором они были даны. \u003c/p\u003e\u003cp\u003eПередвигать одну из границ мы умеем за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(2\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e * 6)\u003c/span\u003e включениями-исключениями (6 оттого, что во включениях-исключениях необходимы только различные простые делители, их не больше 6, 2*3*5*7*11*13 \u003d 30030). Итоговая асимптотика составит \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(2\u003csup class\u003d\"upper-index\"\u003e6\u003c/sup\u003e * 6 * 50000\u003csup class\u003d\"upper-index\"\u003e1.5\u003c/sup\u003e)\u003c/span\u003e\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/J8jgyP\"\u003eКод\u003c/a\u003e\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/E\"\u003e210922B — Сильно связный город 2\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eВкратце: сжимаем все двусвязные компоненты в одну вершину и дальше решаем на дереве. Перебираем корень дерева. Тогда каждый ребенок и все его дети должны быть сонаправлены по отношению к нашему корню (как на рисунке в разборе ниже). Ищем лучший вариант с помощью рюкзака. \u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"//codeforces.com/blog/entry/14168\"\u003eПодробнее, но по-английски\u003c/a\u003e. Признаться честно, я не смотрел, что там, но судя по картинке, там предлагают то же, что и я.\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"//codeforces.com/contest/475/submission/21873105\"\u003eКод\u003c/a\u003e\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/H\"\u003e210922B — Антипростые числа\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eВ задаче для данного \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e необходимо было найти число, не превосходящее \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e, с наибольшим количеством делителей, а среди всех таких минимальное.\u003c/p\u003e\u003cp\u003eВ первой группе можно было искать количество делителей у каждого числа как угодно. Асимптотика \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e или \u003cimg align\u003d\"middle\" class\u003d\"tex-formula\" src\u003d\"/predownloaded/ef/ca/efca22bc7b96159e3b5e41ee779c6ecf500e6996.png\" style\u003d\"max-width: 100.0%;max-height: 100.0%;\" /\u003e.\u003c/p\u003e\u003cp\u003eВо второй группе можно было завести массив \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ed\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e — количество делителей числа \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e. Чтобы быстро насчитать этот массив, можно заметить, что число \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e будет являться делителем чисел \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e2\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e3\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e, ... (и так далее, вплоть до \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e) и никаких других. Поэтому нет смысла затрагивать ячейки массива, отличные от данных. Число \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e будет являться делителем у \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / \u003ci\u003ea\u003c/i\u003e\u003c/span\u003e чисел, поэтому суммарное количество операций составит \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eN\u003c/i\u003e / 1 + \u003ci\u003eN\u003c/i\u003e / 2 + \u003ci\u003eN\u003c/i\u003e / 3 + ... + \u003ci\u003eN\u003c/i\u003e / \u003ci\u003eN\u003c/i\u003e\u003c/span\u003e \u003d \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e \u003ci\u003eln\u003c/i\u003e \u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e (т.н. гармонический ряд). \u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"//codeforces.com/blog/entry/653\"\u003eТретья группа.\u003c/a\u003e\u003c/p\u003e\u003cp\u003eНесмотря на то, что мне известно целых три версии этой задачи, ее порешали довольно плохо :) Надеюсь, факт существования трех одинаковых задач и наличие такой же в контесте никого особо не расстроил.\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/fLcZab\"\u003eКод\u003c/a\u003e.\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/J\"\u003e210922J — Владислав и прыжки по холмам\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eДавайте будем считать \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e — минимальное количество прыжков с некоторого холма на холм не меньшей высоты (то есть то число, которое желает минимизировать Владислав), для того, чтобы допрыгнуть до \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e-ого холма. Очевидно, что \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e1\u003c/sub\u003e \u003d 0\u003c/span\u003e, ответ лежит в \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003en\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. \u003c/p\u003e\u003cp\u003e\u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003emin\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e - \u003ci\u003ek\u003c/i\u003e ≤ \u003ci\u003ej\u003c/i\u003e ≤ \u003ci\u003ei\u003c/i\u003e - 1\u003c/sub\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e + [\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e ≤ \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e]\u003c/span\u003e. \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003ea\u003c/i\u003e ≤ \u003ci\u003eb\u003c/i\u003e]\u003c/span\u003e равно \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e, если \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ea\u003c/i\u003e\u003c/span\u003e не больше \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eb\u003c/i\u003e\u003c/span\u003e и \u003cspan class\u003d\"tex-span\"\u003e0\u003c/span\u003e иначе.\u003c/p\u003e\u003cp\u003eТакое решение работает за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e, что слишком медленно для того, чтобы побороть хотя бы первую группу.\u003c/p\u003e\u003cp\u003eБудем оптимизировать это решение. Сперва пронумеруем все холмы так, чтобы холму с меньшей высотой достался меньший номер(при равенстве не имеет значения, как нумеровать), пусть \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e-ому холму достался номер \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003enum\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eПройдемся по всем холмам по порядку, пусть сейчас мы хотим посчитать \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e для \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e-ого холма. Давайте изначально заведем дерево отрезков, в котором в любой момент времени \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e будут поддерживаться значения \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e для всех холмов, у которых \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e - \u003ci\u003ek\u003c/i\u003e ≤ \u003ci\u003ej\u003c/i\u003e \u0026lt; \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e или довольно большое число иначе; значение \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e будет храниться в листе с номером \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003enum\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Тогда чтобы посчитать \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e, найдем такой максимальный индекс \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ep\u003c/i\u003e\u003c/span\u003e, что все \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e в листах с номером \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e ≤ \u003ci\u003ep\u003c/i\u003e\u003c/span\u003e не больше \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Все такие значения будут составлять непрерывный отрезок, потому что мы так построили наше дерево отрезков. Тогда \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003emin\u003c/i\u003e(\u003ci\u003eminquery\u003c/i\u003e(1, \u003ci\u003ep\u003c/i\u003e) + 1, \u003ci\u003eminquery\u003c/i\u003e(\u003ci\u003ep\u003c/i\u003e + 1, \u003ci\u003en\u003c/i\u003e))\u003c/span\u003e. \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eminquery\u003c/i\u003e(\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e)\u003c/span\u003e — минимум на отрезке \u003cspan class\u003d\"tex-span\"\u003e[\u003ci\u003el\u003c/i\u003e, \u003ci\u003er\u003c/i\u003e]\u003c/span\u003e в дереве отрезков. Переходя к следующему холму, надо не забыть удалить значение \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e - \u003ci\u003ek\u003c/i\u003e - 1\u003c/sub\u003e\u003c/span\u003e(если оно существует) и добавить \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. \u003c/p\u003e\u003cp\u003eТаким образом, итоговая сложность составит \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eNlogN\u003c/i\u003e)\u003c/span\u003e на запрос, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eQ\u003c/i\u003e·\u003ci\u003eN\u003c/i\u003e·\u003ci\u003elogN\u003c/i\u003e)\u003c/span\u003e суммарно, что довольно медленно, чтобы пройти сразу две группы.\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/iOiSIS\"\u003eКод на первую подзадачу\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eЧтобы получить \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e на запрос, заметим следующий факт. Давайте посмотрим на минимальное значение \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003evalue\u003c/i\u003e \u003d \u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e, которым мы могли обновить ответ (для него \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e - \u003ci\u003ek\u003c/i\u003e ≤ \u003ci\u003ej\u003c/i\u003e \u0026lt; \u003ci\u003ei\u003c/i\u003e\u003c/span\u003e). В таком случае, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e ≤ \u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e ≤ \u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e + 1\u003c/span\u003e. Тогда, если существует такое \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/span\u003e, что \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003evalue\u003c/i\u003e, \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e \u0026gt; \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e, то \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e, во всех остальных случаях \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e \u003d \u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e + 1\u003c/span\u003e. Поэтому среди всех возможных вариантов обновления ответа нас будет интересовать такой, у которого \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e минимально, а \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e максимально. Поэтому давайте создадим очередь для минимума, которая будет хранить все такие пары \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003edp\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e, \u003ci\u003eh\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e, которыми мы можем обновить ответ, выбирать наилучшую из них и удалять пару, добавленную раньше всего (ведь мы удаляем всегда пару с индексом \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e - \u003ci\u003ek\u003c/i\u003e - 1\u003c/span\u003e, очевидно, что она была добавлена ранее всех остальных вариантов). \u003c/p\u003e\u003cp\u003eТак как все операции в очереди с минимумом суммарно составляют \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e)\u003c/span\u003e, то итоговое решение работает за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eQ\u003c/i\u003e·\u003ci\u003eN\u003c/i\u003e\u003c/span\u003e).\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/U5jxn1\"\u003eКод на вторую подзадачу\u003c/a\u003e.\u003c/p\u003e\u003ch2\u003e\u003ca href\u003d\"//codeforces.com/group/6bId9YqR5t/contest/210922/problem/M\"\u003e210922M — Конкурс\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eПервая группа решалась обычным перебором всех пар. Асимптотика \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eN\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e·\u003ci\u003eM\u003c/i\u003e)\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eДля решения последующих групп переведем информацию о каждом участнике в битовую маску, где в \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e-ом бите будет стоять \u003cspan class\u003d\"tex-span\"\u003e1\u003c/span\u003e, если у участника в \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e-ой позиции его строки стоял плюс, и \u003cspan class\u003d\"tex-span\"\u003e0\u003c/span\u003e иначе. Обозначим полученную маску как \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eТеперь, если участник \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e превосходит участника \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/span\u003e, то верно \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003emask\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u0026amp; mask\u003csub class\u003d\"lower-index\"\u003ej\u003c/sub\u003e \u003d \u003ci\u003emask\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e)\u003ci\u003eand\u003c/i\u003e(\u003ci\u003emask\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e ≠ \u003ci\u003emask\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e)\u003c/span\u003e. Таким образом можно решить задачу уже за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(\u003ci\u003eNM\u003c/i\u003e + \u003ci\u003eN\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e2\u003c/sup\u003e)\u003c/span\u003e, но группа на такое решение отсутствовала :)\u003c/p\u003e\u003cp\u003eДавайте для каждой маски запомним, сколько раз она встречается в инпуте, пусть для маски \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e это количество равно \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ecnt\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Тогда если маска \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e превосходит маску \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/span\u003e (т.е. \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/span\u003e является подмаской \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/span\u003e), то можно добавить к ответу \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ecnt\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ei\u003c/i\u003e\u003c/sub\u003e·\u003ci\u003ecnt\u003c/i\u003e\u003csub class\u003d\"lower-index\"\u003e\u003ci\u003ej\u003c/i\u003e\u003c/sub\u003e\u003c/span\u003e. Перебирать все пары (маска-подмаска) можно за \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eO\u003c/i\u003e(3\u003csup class\u003d\"upper-index\"\u003e\u003ci\u003eM\u003c/i\u003e\u003c/sup\u003e)\u003c/span\u003e, как это описано \u003ca href\u003d\"http://e-maxx.ru/algo/all_submasks\"\u003eздесь\u003c/a\u003e. Такое решение предполагалось на вторую группу, но из-за моего косяка проходило и третью :)\u003c/p\u003e\u003cp\u003eВ третьей группе подразумевалось следующее решение. Пусть \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e[\u003ci\u003eprefix\u003c/i\u003e][\u003ci\u003emask\u003c/i\u003e]\u003c/span\u003e означает общее количество масок \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u0027\u003c/span\u003e из инпута таких, что маска из первых \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eprefix\u003c/i\u003e\u003c/span\u003e бит \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u0027\u003c/span\u003e является подмаской маски из первых \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003eprefix\u003c/i\u003e\u003c/span\u003e бит маски \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u003c/span\u003e. \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e[0][\u003ci\u003emask\u003c/i\u003e] \u003d \u003ci\u003ecnt\u003c/i\u003e[\u003ci\u003emask\u003c/i\u003e]\u003c/span\u003e. Кажется довольно очевидным, что \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e[\u003ci\u003em\u003c/i\u003e][\u003ci\u003emask\u003c/i\u003e\u003c/span\u003e] будет содержать количество подмасок масок mask (включая саму \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u003c/span\u003e), поэтому ответом на задачу будет сумма по всем маскам \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u003c/span\u003e, \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003ecnt\u003c/i\u003e[\u003ci\u003emask\u003c/i\u003e]·(\u003ci\u003edp\u003c/i\u003e[\u003ci\u003em\u003c/i\u003e][\u003ci\u003emask\u003c/i\u003e] - \u003ci\u003ecnt\u003c/i\u003e[\u003ci\u003emask\u003c/i\u003e]))\u003c/span\u003e.\u003c/p\u003e\u003cp\u003eПереходы: если \u003cspan class\u003d\"tex-span\"\u003e(\u003ci\u003epref\u003c/i\u003e - 1)\u003c/span\u003e-ый бит \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003emask\u003c/i\u003e\u003c/span\u003e равен 1, то \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e[\u003ci\u003epref\u003c/i\u003e][\u003ci\u003emask\u003c/i\u003e] \u003d \u003ci\u003edp\u003c/i\u003e[\u003ci\u003epref\u003c/i\u003e - 1][\u003ci\u003emask\u003c/i\u003e] + \u003ci\u003edp\u003c/i\u003e[\u003ci\u003epref\u003c/i\u003e - 1][\u003ci\u003emask\u003c/i\u003e\u003csup class\u003d\"upper-index\"\u003e\u003c/sup\u003e(1«(\u003ci\u003epref\u003c/i\u003e - 1))]\u003c/span\u003e, иначе \u003cspan class\u003d\"tex-span\"\u003e\u003ci\u003edp\u003c/i\u003e[\u003ci\u003epref\u003c/i\u003e][\u003ci\u003emask\u003c/i\u003e] \u003d \u003ci\u003edp\u003c/i\u003e[\u003ci\u003epref\u003c/i\u003e - 1][\u003ci\u003emask\u003c/i\u003e]\u003c/span\u003e.\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/a8dvEf\"\u003eМой код\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href\u003d\"http://ideone.com/ua6Lhr\"\u003eКод Vladik\u0027а\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e","tags":["kefaa","loves","cyf"]}}